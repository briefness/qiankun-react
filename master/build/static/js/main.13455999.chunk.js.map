{"version":3,"sources":["../webpack/universalModuleDefinition","App.js","utils/globalState.js","index.js","utils/index.js"],"names":["root","factory","exports","module","define","amd","window","App","props","content","loading","goto","title","href","history","pushState","className","style","display","width","onClick","flexGrow","dangerouslySetInnerHTML","__html","globalState","deps","emitGlobal","state","prevState","Object","keys","forEach","id","Function","_cloneDeep","getMicroAppStateActions","isMaster","onGlobalStateChange","callback","fireImmediately","console","warn","concat","cloneState","error","setGlobalState","arguments","length","undefined","changeKeys","prevGlobalState","reduce","_globalState","changeKey","hasOwnProperty","push","assign","_defineProperty","offGlobalStateChange","render","appContent","container","document","getElementById","ReactDOM","genActiveRule","routerPrefix","location","pathname","startsWith","registerMicroApps","name","entry","activeRule","defaultAppLink","Date","initGlobalState","user","value","prev","log","ignore","addEventListener","listener","getMountedApps","navigateToUrl","removeEventListener","start"],"mappings":"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","file":"static/js/main.13455999.chunk.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"main-main\"] = factory();\n\telse\n\t\troot[\"main-main\"] = factory();\n})(window, function() {\nreturn ","/*\n * @Author: your name\n * @Date: 2021-01-12 10:42:07\n * @LastEditTime: 2021-01-12 13:59:27\n * @LastEditors: Please set LastEditors\n * @Description: In User Settings Edit\n * @FilePath: /webpack-test/Users/mory/Desktop/qiankun-react/src/App.js\n */\nimport React from 'react';\n\nimport './App.css';\n\nfunction App(props) {\n\n  const { content, loading } = props;\n\n  // 路由跳转\n  function goto(title, href) {\n    window.history.pushState({}, title, href);\n  }\n  \n  return (\n    <div className=\"App\" style={{ display: 'flex' }}>\n      <div style={{ width: 100 }}>\n        <button onClick={() => goto('react1', '/react1')}>react1</button>\n        <button onClick={() => goto('react2', '/react2')}>react2</button>\n      </div>\n      <div style={{ flexGrow: 1 }}>\n        {loading && <div className=\"mask\">loading...</div>}\n        <div dangerouslySetInnerHTML={{ __html: content }} />\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n","import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _cloneDeep from \"lodash/cloneDeep\";\nvar globalState = {};\nvar deps = {}; // 触发全局监听\n\nfunction emitGlobal(state, prevState) {\n  Object.keys(deps).forEach(function (id) {\n    if (deps[id] instanceof Function) {\n      deps[id](_cloneDeep(state), _cloneDeep(prevState));\n    }\n  });\n}\n\nexport function initGlobalState() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n  if (state === globalState) {\n    console.warn('[qiankun] state has not changed！');\n  } else {\n    var prevGlobalState = _cloneDeep(globalState);\n\n    globalState = _cloneDeep(state);\n    emitGlobal(globalState, prevGlobalState);\n  }\n\n  return getMicroAppStateActions(\"global-\".concat(+new Date()), true);\n}\nexport function getMicroAppStateActions(id, isMaster) {\n  return {\n    /**\n     * onGlobalStateChange 全局依赖监听\n     *\n     * 收集 setState 时所需要触发的依赖\n     *\n     * 限制条件：每个子应用只有一个激活状态的全局监听，新监听覆盖旧监听，若只是监听部分属性，请使用 onGlobalStateChange\n     *\n     * 这么设计是为了减少全局监听滥用导致的内存爆炸\n     *\n     * 依赖数据结构为：\n     * {\n     *   {id}: callback\n     * }\n     *\n     * @param callback\n     * @param fireImmediately\n     */\n    onGlobalStateChange: function onGlobalStateChange(callback, fireImmediately) {\n      if (!(callback instanceof Function)) {\n        console.error('[qiankun] callback must be function!');\n        return;\n      }\n\n      if (deps[id]) {\n        console.warn(\"[qiankun] '\".concat(id, \"' global listener already exists before this, new listener will overwrite it.\"));\n      }\n\n      deps[id] = callback;\n\n      var cloneState = _cloneDeep(globalState);\n\n      if (fireImmediately) {\n        callback(cloneState, cloneState);\n      }\n    },\n\n    /**\n     * setGlobalState 更新 store 数据\n     *\n     * 1. 对输入 state 的第一层属性做校验，只有初始化时声明过的第一层（bucket）属性才会被更改\n     * 2. 修改 store 并触发全局监听\n     *\n     * @param state\n     */\n    setGlobalState: function setGlobalState() {\n      var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n      if (state === globalState) {\n        console.warn('[qiankun] state has not changed！');\n        return false;\n      }\n\n      var changeKeys = [];\n\n      var prevGlobalState = _cloneDeep(globalState);\n\n      globalState = _cloneDeep(Object.keys(state).reduce(function (_globalState, changeKey) {\n        if (isMaster || _globalState.hasOwnProperty(changeKey)) {\n          changeKeys.push(changeKey);\n          return Object.assign(_globalState, _defineProperty({}, changeKey, state[changeKey]));\n        }\n\n        console.warn(\"[qiankun] '\".concat(changeKey, \"' not declared when init state\\uFF01\"));\n        return _globalState;\n      }, globalState));\n\n      if (changeKeys.length === 0) {\n        console.warn('[qiankun] state has not changed！');\n        return false;\n      }\n\n      emitGlobal(globalState, prevGlobalState);\n      return true;\n    },\n    // 注销该应用下的依赖\n    offGlobalStateChange: function offGlobalStateChange() {\n      delete deps[id];\n      return true;\n    }\n  };\n}","/*\n * @Author: your name\n * @Date: 2021-01-12 10:42:07\n * @LastEditTime: 2021-01-27 14:08:18\n * @LastEditors: Please set LastEditors\n * @Description: In User Settings Edit\n * @FilePath: /webpack-test/Users/mory/Desktop/qiankun-react/src/index.js\n */\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n// import * as serviceWorker from './serviceWorker';\nimport { registerMicroApps, start } from 'qiankun';\n\nimport { setDefaultMountApp } from './utils';\n\nimport { initGlobalState } from './utils/globalState';\n\nfunction render({ appContent, loading }) {\n  const container = document.getElementById('root');\n  ReactDOM.render(<App loading={loading} content={appContent} />, container);\n}\n\n/**\n * Step1 初始化应用（可选）\n */\nrender({ loading: true });\n\nfunction genActiveRule(routerPrefix) {\n  return location => location.pathname.startsWith(routerPrefix);\n}\n\n/**\n * Step2 注册子应用\n * entry： 为微应用的访问地址\n */\nregisterMicroApps([\n  {\n    name: 'react1',\n    entry: '//localhost:6651',\n    render,\n    activeRule: genActiveRule('/react1')\n  },\n  {\n    name: 'react2',\n    entry: '//localhost:6652',\n    render,\n    activeRule: genActiveRule('/react2') \n  },\n]);\n\nconst { onGlobalStateChange, setGlobalState } = initGlobalState({\n  user: 'qiankun',\n});\n\nonGlobalStateChange((value, prev) => console.log('[onGlobalStateChange - master]:', value, prev));\n\nsetGlobalState({\n  ignore: 'master',\n  user: {\n    name: 'master',\n  },\n});\n\n/**\n * Step3 设置默认进入的子应用\n */\nsetDefaultMountApp('/react1');\n\n/**\n * Step4 启动应用\n */\nstart();\n\n\n// serviceWorker.unregister();","/*\n * @Author: Lucas\n * @Date: 2021-01-12 14:23:58\n * @LastEditTime: 2021-01-12 15:04:26\n * @LastEditors: Please set LastEditors\n * @Description: 工具库\n * @FilePath: /webpack-test/Users/mory/Desktop/qiankun-react/utils/index.js\n */\n\nimport { getMountedApps, navigateToUrl } from 'single-spa';\n\n// 设置默认路由\nexport function setDefaultMountApp(defaultAppLink) {\n  // can not use addEventListener once option for ie support\n  window.addEventListener('single-spa:no-app-change', function listener() {\n    var mountedApps = getMountedApps();\n\n    if (!mountedApps.length) {\n      navigateToUrl(defaultAppLink);\n    }\n\n    window.removeEventListener('single-spa:no-app-change', listener);\n  });\n}\n"],"sourceRoot":""}