{"ast":null,"code":"/**\n * @author Kuitos\n * @since 2020-04-13\n */\nimport { isBoundedFunction, isCallable, isConstructable } from '../utils';\nvar currentRunningSandboxProxy;\nexport function getCurrentRunningSandboxProxy() {\n  return currentRunningSandboxProxy;\n}\nexport function setCurrentRunningSandboxProxy(proxy) {\n  currentRunningSandboxProxy = proxy;\n}\nvar functionBoundedValueMap = new WeakMap();\nexport function getTargetValue(target, value) {\n  var cachedBoundFunction = functionBoundedValueMap.get(value);\n\n  if (cachedBoundFunction) {\n    return cachedBoundFunction;\n  }\n  /*\n    仅绑定 isCallable && !isBoundedFunction && !isConstructable 的函数对象，如 window.console、window.atob 这类。目前没有完美的检测方式，这里通过 prototype 中是否还有可枚举的拓展方法的方式来判断\n    @warning 这里不要随意替换成别的判断方式，因为可能触发一些 edge case（比如在 lodash.isFunction 在 iframe 上下文中可能由于调用了 top window 对象触发的安全异常）\n   */\n\n\n  if (isCallable(value) && !isBoundedFunction(value) && !isConstructable(value)) {\n    var boundValue = Function.prototype.bind.call(value, target); // some callable function has custom fields, we need to copy the enumerable props to boundValue. such as moment function.\n    // use for..in rather than Object.keys.forEach for performance reason\n    // eslint-disable-next-line guard-for-in,no-restricted-syntax\n\n    for (var key in value) {\n      boundValue[key] = value[key];\n    } // copy prototype if bound function not have\n    // mostly a bound function have no own prototype, but it not absolute in some old version browser, see https://github.com/umijs/qiankun/issues/1121\n\n\n    if (value.hasOwnProperty('prototype') && !boundValue.hasOwnProperty('prototype')) boundValue.prototype = value.prototype;\n    functionBoundedValueMap.set(value, boundValue);\n    return boundValue;\n  }\n\n  return value;\n}\nvar getterInvocationResultMap = new WeakMap();\nexport function getProxyPropertyValue(getter) {\n  var getterResult = getterInvocationResultMap.get(getter);\n\n  if (!getterResult) {\n    var result = getter();\n    getterInvocationResultMap.set(getter, result);\n    return result;\n  }\n\n  return getterResult;\n}","map":{"version":3,"sources":["/Users/mory/Desktop/qiankun-react/master/node_modules/qiankun/es/sandbox/common.js"],"names":["isBoundedFunction","isCallable","isConstructable","currentRunningSandboxProxy","getCurrentRunningSandboxProxy","setCurrentRunningSandboxProxy","proxy","functionBoundedValueMap","WeakMap","getTargetValue","target","value","cachedBoundFunction","get","boundValue","Function","prototype","bind","call","key","hasOwnProperty","set","getterInvocationResultMap","getProxyPropertyValue","getter","getterResult","result"],"mappings":"AAAA;AACA;AACA;AACA;AACA,SAASA,iBAAT,EAA4BC,UAA5B,EAAwCC,eAAxC,QAA+D,UAA/D;AACA,IAAIC,0BAAJ;AACA,OAAO,SAASC,6BAAT,GAAyC;AAC9C,SAAOD,0BAAP;AACD;AACD,OAAO,SAASE,6BAAT,CAAuCC,KAAvC,EAA8C;AACnDH,EAAAA,0BAA0B,GAAGG,KAA7B;AACD;AACD,IAAIC,uBAAuB,GAAG,IAAIC,OAAJ,EAA9B;AACA,OAAO,SAASC,cAAT,CAAwBC,MAAxB,EAAgCC,KAAhC,EAAuC;AAC5C,MAAIC,mBAAmB,GAAGL,uBAAuB,CAACM,GAAxB,CAA4BF,KAA5B,CAA1B;;AAEA,MAAIC,mBAAJ,EAAyB;AACvB,WAAOA,mBAAP;AACD;AACD;AACF;AACA;AACA;;;AAGE,MAAIX,UAAU,CAACU,KAAD,CAAV,IAAqB,CAACX,iBAAiB,CAACW,KAAD,CAAvC,IAAkD,CAACT,eAAe,CAACS,KAAD,CAAtE,EAA+E;AAC7E,QAAIG,UAAU,GAAGC,QAAQ,CAACC,SAAT,CAAmBC,IAAnB,CAAwBC,IAAxB,CAA6BP,KAA7B,EAAoCD,MAApC,CAAjB,CAD6E,CACf;AAC9D;AACA;;AAEA,SAAK,IAAIS,GAAT,IAAgBR,KAAhB,EAAuB;AACrBG,MAAAA,UAAU,CAACK,GAAD,CAAV,GAAkBR,KAAK,CAACQ,GAAD,CAAvB;AACD,KAP4E,CAO3E;AACF;;;AAGA,QAAIR,KAAK,CAACS,cAAN,CAAqB,WAArB,KAAqC,CAACN,UAAU,CAACM,cAAX,CAA0B,WAA1B,CAA1C,EAAkFN,UAAU,CAACE,SAAX,GAAuBL,KAAK,CAACK,SAA7B;AAClFT,IAAAA,uBAAuB,CAACc,GAAxB,CAA4BV,KAA5B,EAAmCG,UAAnC;AACA,WAAOA,UAAP;AACD;;AAED,SAAOH,KAAP;AACD;AACD,IAAIW,yBAAyB,GAAG,IAAId,OAAJ,EAAhC;AACA,OAAO,SAASe,qBAAT,CAA+BC,MAA/B,EAAuC;AAC5C,MAAIC,YAAY,GAAGH,yBAAyB,CAACT,GAA1B,CAA8BW,MAA9B,CAAnB;;AAEA,MAAI,CAACC,YAAL,EAAmB;AACjB,QAAIC,MAAM,GAAGF,MAAM,EAAnB;AACAF,IAAAA,yBAAyB,CAACD,GAA1B,CAA8BG,MAA9B,EAAsCE,MAAtC;AACA,WAAOA,MAAP;AACD;;AAED,SAAOD,YAAP;AACD","sourcesContent":["/**\n * @author Kuitos\n * @since 2020-04-13\n */\nimport { isBoundedFunction, isCallable, isConstructable } from '../utils';\nvar currentRunningSandboxProxy;\nexport function getCurrentRunningSandboxProxy() {\n  return currentRunningSandboxProxy;\n}\nexport function setCurrentRunningSandboxProxy(proxy) {\n  currentRunningSandboxProxy = proxy;\n}\nvar functionBoundedValueMap = new WeakMap();\nexport function getTargetValue(target, value) {\n  var cachedBoundFunction = functionBoundedValueMap.get(value);\n\n  if (cachedBoundFunction) {\n    return cachedBoundFunction;\n  }\n  /*\n    仅绑定 isCallable && !isBoundedFunction && !isConstructable 的函数对象，如 window.console、window.atob 这类。目前没有完美的检测方式，这里通过 prototype 中是否还有可枚举的拓展方法的方式来判断\n    @warning 这里不要随意替换成别的判断方式，因为可能触发一些 edge case（比如在 lodash.isFunction 在 iframe 上下文中可能由于调用了 top window 对象触发的安全异常）\n   */\n\n\n  if (isCallable(value) && !isBoundedFunction(value) && !isConstructable(value)) {\n    var boundValue = Function.prototype.bind.call(value, target); // some callable function has custom fields, we need to copy the enumerable props to boundValue. such as moment function.\n    // use for..in rather than Object.keys.forEach for performance reason\n    // eslint-disable-next-line guard-for-in,no-restricted-syntax\n\n    for (var key in value) {\n      boundValue[key] = value[key];\n    } // copy prototype if bound function not have\n    // mostly a bound function have no own prototype, but it not absolute in some old version browser, see https://github.com/umijs/qiankun/issues/1121\n\n\n    if (value.hasOwnProperty('prototype') && !boundValue.hasOwnProperty('prototype')) boundValue.prototype = value.prototype;\n    functionBoundedValueMap.set(value, boundValue);\n    return boundValue;\n  }\n\n  return value;\n}\nvar getterInvocationResultMap = new WeakMap();\nexport function getProxyPropertyValue(getter) {\n  var getterResult = getterInvocationResultMap.get(getter);\n\n  if (!getterResult) {\n    var result = getter();\n    getterInvocationResultMap.set(getter, result);\n    return result;\n  }\n\n  return getterResult;\n}"]},"metadata":{},"sourceType":"module"}