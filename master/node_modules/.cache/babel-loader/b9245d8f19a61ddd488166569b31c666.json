{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\n/**\n * @author Saviio\n * @since 2020-4-19\n */\n// https://developer.mozilla.org/en-US/docs/Web/API/CSSRule\n\nvar RuleType;\n\n(function (RuleType) {\n  // type: rule will be rewrote\n  RuleType[RuleType[\"STYLE\"] = 1] = \"STYLE\";\n  RuleType[RuleType[\"MEDIA\"] = 4] = \"MEDIA\";\n  RuleType[RuleType[\"SUPPORTS\"] = 12] = \"SUPPORTS\"; // type: value will be kept\n\n  RuleType[RuleType[\"IMPORT\"] = 3] = \"IMPORT\";\n  RuleType[RuleType[\"FONT_FACE\"] = 5] = \"FONT_FACE\";\n  RuleType[RuleType[\"PAGE\"] = 6] = \"PAGE\";\n  RuleType[RuleType[\"KEYFRAMES\"] = 7] = \"KEYFRAMES\";\n  RuleType[RuleType[\"KEYFRAME\"] = 8] = \"KEYFRAME\";\n})(RuleType || (RuleType = {}));\n\nvar arrayify = function arrayify(list) {\n  return [].slice.call(list, 0);\n};\n\nvar rawDocumentBodyAppend = HTMLBodyElement.prototype.appendChild;\nexport var ScopedCSS = /*#__PURE__*/function () {\n  function ScopedCSS() {\n    _classCallCheck(this, ScopedCSS);\n\n    var styleNode = document.createElement('style');\n    rawDocumentBodyAppend.call(document.body, styleNode);\n    this.swapNode = styleNode;\n    this.sheet = styleNode.sheet;\n    this.sheet.disabled = true;\n  }\n\n  _createClass(ScopedCSS, [{\n    key: \"process\",\n    value: function process(styleNode) {\n      var _this = this;\n\n      var prefix = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n\n      var _a;\n\n      if (styleNode.textContent !== '') {\n        var textNode = document.createTextNode(styleNode.textContent || '');\n        this.swapNode.appendChild(textNode);\n        var sheet = this.swapNode.sheet; // type is missing\n\n        var rules = arrayify((_a = sheet === null || sheet === void 0 ? void 0 : sheet.cssRules) !== null && _a !== void 0 ? _a : []);\n        var css = this.rewrite(rules, prefix); // eslint-disable-next-line no-param-reassign\n\n        styleNode.textContent = css; // cleanup\n\n        this.swapNode.removeChild(textNode);\n        return;\n      }\n\n      var mutator = new MutationObserver(function (mutations) {\n        var _a;\n\n        for (var i = 0; i < mutations.length; i += 1) {\n          var mutation = mutations[i];\n\n          if (ScopedCSS.ModifiedTag in styleNode) {\n            return;\n          }\n\n          if (mutation.type === 'childList') {\n            var _sheet = styleNode.sheet;\n\n            var _rules = arrayify((_a = _sheet === null || _sheet === void 0 ? void 0 : _sheet.cssRules) !== null && _a !== void 0 ? _a : []);\n\n            var _css = _this.rewrite(_rules, prefix); // eslint-disable-next-line no-param-reassign\n\n\n            styleNode.textContent = _css; // eslint-disable-next-line no-param-reassign\n\n            styleNode[ScopedCSS.ModifiedTag] = true;\n          }\n        }\n      }); // since observer will be deleted when node be removed\n      // we dont need create a cleanup function manually\n      // see https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver/disconnect\n\n      mutator.observe(styleNode, {\n        childList: true\n      });\n    }\n  }, {\n    key: \"rewrite\",\n    value: function rewrite(rules) {\n      var _this2 = this;\n\n      var prefix = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n      var css = '';\n      rules.forEach(function (rule) {\n        switch (rule.type) {\n          case RuleType.STYLE:\n            css += _this2.ruleStyle(rule, prefix);\n            break;\n\n          case RuleType.MEDIA:\n            css += _this2.ruleMedia(rule, prefix);\n            break;\n\n          case RuleType.SUPPORTS:\n            css += _this2.ruleSupport(rule, prefix);\n            break;\n\n          default:\n            css += \"\".concat(rule.cssText);\n            break;\n        }\n      });\n      return css;\n    } // handle case:\n    // .app-main {}\n    // html, body {}\n    // eslint-disable-next-line class-methods-use-this\n\n  }, {\n    key: \"ruleStyle\",\n    value: function ruleStyle(rule, prefix) {\n      var rootSelectorRE = /((?:[^\\w\\-.#]|^)(body|html|:root))/gm;\n      var rootCombinationRE = /(html[^\\w{[]+)/gm;\n      var selector = rule.selectorText.trim();\n      var cssText = rule.cssText; // handle html { ... }\n      // handle body { ... }\n      // handle :root { ... }\n\n      if (selector === 'html' || selector === 'body' || selector === ':root') {\n        return cssText.replace(rootSelectorRE, prefix);\n      } // handle html body { ... }\n      // handle html > body { ... }\n\n\n      if (rootCombinationRE.test(rule.selectorText)) {\n        var siblingSelectorRE = /(html[^\\w{]+)(\\+|~)/gm; // since html + body is a non-standard rule for html\n        // transformer will ignore it\n\n        if (!siblingSelectorRE.test(rule.selectorText)) {\n          cssText = cssText.replace(rootCombinationRE, '');\n        }\n      } // handle grouping selector, a,span,p,div { ... }\n\n\n      cssText = cssText.replace(/^[\\s\\S]+{/, function (selectors) {\n        return selectors.replace(/(^|,\\n?)([^,]+)/g, function (item, p, s) {\n          // handle div,body,span { ... }\n          if (rootSelectorRE.test(item)) {\n            return item.replace(rootSelectorRE, function (m) {\n              // do not discard valid previous character, such as body,html or *:not(:root)\n              var whitePrevChars = [',', '('];\n\n              if (m && whitePrevChars.includes(m[0])) {\n                return \"\".concat(m[0]).concat(prefix);\n              } // replace root selector with prefix\n\n\n              return prefix;\n            });\n          }\n\n          return \"\".concat(p).concat(prefix, \" \").concat(s.replace(/^ */, ''));\n        });\n      });\n      return cssText;\n    } // handle case:\n    // @media screen and (max-width: 300px) {}\n\n  }, {\n    key: \"ruleMedia\",\n    value: function ruleMedia(rule, prefix) {\n      var css = this.rewrite(arrayify(rule.cssRules), prefix);\n      return \"@media \".concat(rule.conditionText, \" {\").concat(css, \"}\");\n    } // handle case:\n    // @supports (display: grid) {}\n\n  }, {\n    key: \"ruleSupport\",\n    value: function ruleSupport(rule, prefix) {\n      var css = this.rewrite(arrayify(rule.cssRules), prefix);\n      return \"@supports \".concat(rule.conditionText, \" {\").concat(css, \"}\");\n    }\n  }]);\n\n  return ScopedCSS;\n}();\nScopedCSS.ModifiedTag = 'Symbol(style-modified-qiankun)';\nvar processor;\nexport var QiankunCSSRewriteAttr = 'data-qiankun';\nexport var process = function process(appWrapper, stylesheetElement, appName) {\n  // lazy singleton pattern\n  if (!processor) {\n    processor = new ScopedCSS();\n  }\n\n  if (stylesheetElement.tagName === 'LINK') {\n    console.warn('Feature: sandbox.experimentalStyleIsolation is not support for link element yet.');\n  }\n\n  var mountDOM = appWrapper;\n\n  if (!mountDOM) {\n    return;\n  }\n\n  var tag = (mountDOM.tagName || '').toLowerCase();\n\n  if (tag && stylesheetElement.tagName === 'STYLE') {\n    var prefix = \"\".concat(tag, \"[\").concat(QiankunCSSRewriteAttr, \"=\\\"\").concat(appName, \"\\\"]\");\n    processor.process(stylesheetElement, prefix);\n  }\n};","map":{"version":3,"sources":["/Users/mory/Desktop/qiankun-react/master/node_modules/qiankun/es/sandbox/patchers/css.js"],"names":["_classCallCheck","_createClass","RuleType","arrayify","list","slice","call","rawDocumentBodyAppend","HTMLBodyElement","prototype","appendChild","ScopedCSS","styleNode","document","createElement","body","swapNode","sheet","disabled","key","value","process","_this","prefix","arguments","length","undefined","_a","textContent","textNode","createTextNode","rules","cssRules","css","rewrite","removeChild","mutator","MutationObserver","mutations","i","mutation","ModifiedTag","type","_sheet","_rules","_css","observe","childList","_this2","forEach","rule","STYLE","ruleStyle","MEDIA","ruleMedia","SUPPORTS","ruleSupport","concat","cssText","rootSelectorRE","rootCombinationRE","selector","selectorText","trim","replace","test","siblingSelectorRE","selectors","item","p","s","m","whitePrevChars","includes","conditionText","processor","QiankunCSSRewriteAttr","appWrapper","stylesheetElement","appName","tagName","console","warn","mountDOM","tag","toLowerCase"],"mappings":"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","sourcesContent":["import _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\n\n/**\n * @author Saviio\n * @since 2020-4-19\n */\n// https://developer.mozilla.org/en-US/docs/Web/API/CSSRule\nvar RuleType;\n\n(function (RuleType) {\n  // type: rule will be rewrote\n  RuleType[RuleType[\"STYLE\"] = 1] = \"STYLE\";\n  RuleType[RuleType[\"MEDIA\"] = 4] = \"MEDIA\";\n  RuleType[RuleType[\"SUPPORTS\"] = 12] = \"SUPPORTS\"; // type: value will be kept\n\n  RuleType[RuleType[\"IMPORT\"] = 3] = \"IMPORT\";\n  RuleType[RuleType[\"FONT_FACE\"] = 5] = \"FONT_FACE\";\n  RuleType[RuleType[\"PAGE\"] = 6] = \"PAGE\";\n  RuleType[RuleType[\"KEYFRAMES\"] = 7] = \"KEYFRAMES\";\n  RuleType[RuleType[\"KEYFRAME\"] = 8] = \"KEYFRAME\";\n})(RuleType || (RuleType = {}));\n\nvar arrayify = function arrayify(list) {\n  return [].slice.call(list, 0);\n};\n\nvar rawDocumentBodyAppend = HTMLBodyElement.prototype.appendChild;\nexport var ScopedCSS = /*#__PURE__*/function () {\n  function ScopedCSS() {\n    _classCallCheck(this, ScopedCSS);\n\n    var styleNode = document.createElement('style');\n    rawDocumentBodyAppend.call(document.body, styleNode);\n    this.swapNode = styleNode;\n    this.sheet = styleNode.sheet;\n    this.sheet.disabled = true;\n  }\n\n  _createClass(ScopedCSS, [{\n    key: \"process\",\n    value: function process(styleNode) {\n      var _this = this;\n\n      var prefix = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n\n      var _a;\n\n      if (styleNode.textContent !== '') {\n        var textNode = document.createTextNode(styleNode.textContent || '');\n        this.swapNode.appendChild(textNode);\n        var sheet = this.swapNode.sheet; // type is missing\n\n        var rules = arrayify((_a = sheet === null || sheet === void 0 ? void 0 : sheet.cssRules) !== null && _a !== void 0 ? _a : []);\n        var css = this.rewrite(rules, prefix); // eslint-disable-next-line no-param-reassign\n\n        styleNode.textContent = css; // cleanup\n\n        this.swapNode.removeChild(textNode);\n        return;\n      }\n\n      var mutator = new MutationObserver(function (mutations) {\n        var _a;\n\n        for (var i = 0; i < mutations.length; i += 1) {\n          var mutation = mutations[i];\n\n          if (ScopedCSS.ModifiedTag in styleNode) {\n            return;\n          }\n\n          if (mutation.type === 'childList') {\n            var _sheet = styleNode.sheet;\n\n            var _rules = arrayify((_a = _sheet === null || _sheet === void 0 ? void 0 : _sheet.cssRules) !== null && _a !== void 0 ? _a : []);\n\n            var _css = _this.rewrite(_rules, prefix); // eslint-disable-next-line no-param-reassign\n\n\n            styleNode.textContent = _css; // eslint-disable-next-line no-param-reassign\n\n            styleNode[ScopedCSS.ModifiedTag] = true;\n          }\n        }\n      }); // since observer will be deleted when node be removed\n      // we dont need create a cleanup function manually\n      // see https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver/disconnect\n\n      mutator.observe(styleNode, {\n        childList: true\n      });\n    }\n  }, {\n    key: \"rewrite\",\n    value: function rewrite(rules) {\n      var _this2 = this;\n\n      var prefix = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n      var css = '';\n      rules.forEach(function (rule) {\n        switch (rule.type) {\n          case RuleType.STYLE:\n            css += _this2.ruleStyle(rule, prefix);\n            break;\n\n          case RuleType.MEDIA:\n            css += _this2.ruleMedia(rule, prefix);\n            break;\n\n          case RuleType.SUPPORTS:\n            css += _this2.ruleSupport(rule, prefix);\n            break;\n\n          default:\n            css += \"\".concat(rule.cssText);\n            break;\n        }\n      });\n      return css;\n    } // handle case:\n    // .app-main {}\n    // html, body {}\n    // eslint-disable-next-line class-methods-use-this\n\n  }, {\n    key: \"ruleStyle\",\n    value: function ruleStyle(rule, prefix) {\n      var rootSelectorRE = /((?:[^\\w\\-.#]|^)(body|html|:root))/gm;\n      var rootCombinationRE = /(html[^\\w{[]+)/gm;\n      var selector = rule.selectorText.trim();\n      var cssText = rule.cssText; // handle html { ... }\n      // handle body { ... }\n      // handle :root { ... }\n\n      if (selector === 'html' || selector === 'body' || selector === ':root') {\n        return cssText.replace(rootSelectorRE, prefix);\n      } // handle html body { ... }\n      // handle html > body { ... }\n\n\n      if (rootCombinationRE.test(rule.selectorText)) {\n        var siblingSelectorRE = /(html[^\\w{]+)(\\+|~)/gm; // since html + body is a non-standard rule for html\n        // transformer will ignore it\n\n        if (!siblingSelectorRE.test(rule.selectorText)) {\n          cssText = cssText.replace(rootCombinationRE, '');\n        }\n      } // handle grouping selector, a,span,p,div { ... }\n\n\n      cssText = cssText.replace(/^[\\s\\S]+{/, function (selectors) {\n        return selectors.replace(/(^|,\\n?)([^,]+)/g, function (item, p, s) {\n          // handle div,body,span { ... }\n          if (rootSelectorRE.test(item)) {\n            return item.replace(rootSelectorRE, function (m) {\n              // do not discard valid previous character, such as body,html or *:not(:root)\n              var whitePrevChars = [',', '('];\n\n              if (m && whitePrevChars.includes(m[0])) {\n                return \"\".concat(m[0]).concat(prefix);\n              } // replace root selector with prefix\n\n\n              return prefix;\n            });\n          }\n\n          return \"\".concat(p).concat(prefix, \" \").concat(s.replace(/^ */, ''));\n        });\n      });\n      return cssText;\n    } // handle case:\n    // @media screen and (max-width: 300px) {}\n\n  }, {\n    key: \"ruleMedia\",\n    value: function ruleMedia(rule, prefix) {\n      var css = this.rewrite(arrayify(rule.cssRules), prefix);\n      return \"@media \".concat(rule.conditionText, \" {\").concat(css, \"}\");\n    } // handle case:\n    // @supports (display: grid) {}\n\n  }, {\n    key: \"ruleSupport\",\n    value: function ruleSupport(rule, prefix) {\n      var css = this.rewrite(arrayify(rule.cssRules), prefix);\n      return \"@supports \".concat(rule.conditionText, \" {\").concat(css, \"}\");\n    }\n  }]);\n\n  return ScopedCSS;\n}();\nScopedCSS.ModifiedTag = 'Symbol(style-modified-qiankun)';\nvar processor;\nexport var QiankunCSSRewriteAttr = 'data-qiankun';\nexport var process = function process(appWrapper, stylesheetElement, appName) {\n  // lazy singleton pattern\n  if (!processor) {\n    processor = new ScopedCSS();\n  }\n\n  if (stylesheetElement.tagName === 'LINK') {\n    console.warn('Feature: sandbox.experimentalStyleIsolation is not support for link element yet.');\n  }\n\n  var mountDOM = appWrapper;\n\n  if (!mountDOM) {\n    return;\n  }\n\n  var tag = (mountDOM.tagName || '').toLowerCase();\n\n  if (tag && stylesheetElement.tagName === 'STYLE') {\n    var prefix = \"\".concat(tag, \"[\").concat(QiankunCSSRewriteAttr, \"=\\\"\").concat(appName, \"\\\"]\");\n    processor.process(stylesheetElement, prefix);\n  }\n};"]},"metadata":{},"sourceType":"module"}