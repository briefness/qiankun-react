{"ast":null,"code":"import _concat from \"lodash/concat\";\nimport _mergeWith2 from \"lodash/mergeWith\";\nimport _typeof from \"@babel/runtime/helpers/esm/typeof\";\nimport _forEach from \"lodash/forEach\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n/**\n * @author Kuitos\n * @since 2020-04-01\n */\n\nimport { __awaiter, __rest } from \"tslib\";\nimport { importEntry } from 'import-html-entry';\nimport getAddOns from './addons';\nimport { getMicroAppStateActions } from './globalState';\nimport { createSandboxContainer, css } from './sandbox';\nimport { Deferred, getContainer, getDefaultTplWrapper, getWrapperId, isEnableScopedCSS, performanceMark, performanceMeasure, performanceGetEntriesByName, toArray, validateExportLifecycle } from './utils';\n\nfunction assertElementExist(element, msg) {\n  if (!element) {\n    if (msg) {\n      throw new Error(msg);\n    }\n\n    throw new Error('[qiankun] element not existed!');\n  }\n}\n\nfunction execHooksChain(hooks, app) {\n  var global = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : window;\n\n  if (hooks.length) {\n    return hooks.reduce(function (chain, hook) {\n      return chain.then(function () {\n        return hook(app, global);\n      });\n    }, Promise.resolve());\n  }\n\n  return Promise.resolve();\n}\n\nfunction validateSingularMode(validate, app) {\n  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            return _context.abrupt(\"return\", typeof validate === 'function' ? validate(app) : !!validate);\n\n          case 1:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n} // @ts-ignore\n\n\nvar supportShadowDOM = document.head.attachShadow || document.head.createShadowRoot;\n\nfunction createElement(appContent, strictStyleIsolation, scopedCSS, appName) {\n  var containerElement = document.createElement('div');\n  containerElement.innerHTML = appContent; // appContent always wrapped with a singular div\n\n  var appElement = containerElement.firstChild;\n\n  if (strictStyleIsolation) {\n    if (!supportShadowDOM) {\n      console.warn('[qiankun]: As current browser not support shadow dom, your strictStyleIsolation configuration will be ignored!');\n    } else {\n      var innerHTML = appElement.innerHTML;\n      appElement.innerHTML = '';\n      var shadow;\n\n      if (appElement.attachShadow) {\n        shadow = appElement.attachShadow({\n          mode: 'open'\n        });\n      } else {\n        // createShadowRoot was proposed in initial spec, which has then been deprecated\n        shadow = appElement.createShadowRoot();\n      }\n\n      shadow.innerHTML = innerHTML;\n    }\n  }\n\n  if (scopedCSS) {\n    var attr = appElement.getAttribute(css.QiankunCSSRewriteAttr);\n\n    if (!attr) {\n      appElement.setAttribute(css.QiankunCSSRewriteAttr, appName);\n    }\n\n    var styleNodes = appElement.querySelectorAll('style') || [];\n\n    _forEach(styleNodes, function (stylesheetElement) {\n      css.process(appElement, stylesheetElement, appName);\n    });\n  }\n\n  return appElement;\n}\n/** generate app wrapper dom getter */\n\n\nfunction getAppWrapperGetter(appName, appInstanceId, useLegacyRender, strictStyleIsolation, scopedCSS, elementGetter) {\n  return function () {\n    if (useLegacyRender) {\n      if (strictStyleIsolation) throw new Error('[qiankun]: strictStyleIsolation can not be used with legacy render!');\n      if (scopedCSS) throw new Error('[qiankun]: experimentalStyleIsolation can not be used with legacy render!');\n      var appWrapper = document.getElementById(getWrapperId(appInstanceId));\n      assertElementExist(appWrapper, \"[qiankun] Wrapper element for \".concat(appName, \" with instance \").concat(appInstanceId, \" is not existed!\"));\n      return appWrapper;\n    }\n\n    var element = elementGetter();\n    assertElementExist(element, \"[qiankun] Wrapper element for \".concat(appName, \" with instance \").concat(appInstanceId, \" is not existed!\"));\n\n    if (strictStyleIsolation) {\n      return element.shadowRoot;\n    }\n\n    return element;\n  };\n}\n\nvar rawAppendChild = HTMLElement.prototype.appendChild;\nvar rawRemoveChild = HTMLElement.prototype.removeChild;\n/**\n * Get the render function\n * If the legacy render function is provide, used as it, otherwise we will insert the app element to target container by qiankun\n * @param appName\n * @param appContent\n * @param legacyRender\n */\n\nfunction getRender(appName, appContent, legacyRender) {\n  var render = function render(_ref, phase) {\n    var element = _ref.element,\n        loading = _ref.loading,\n        container = _ref.container;\n\n    if (legacyRender) {\n      if (process.env.NODE_ENV === 'development') {\n        console.warn('[qiankun] Custom rendering function is deprecated, you can use the container element setting instead!');\n      }\n\n      return legacyRender({\n        loading: loading,\n        appContent: element ? appContent : ''\n      });\n    }\n\n    var containerElement = getContainer(container); // The container might have be removed after micro app unmounted.\n    // Such as the micro app unmount lifecycle called by a react componentWillUnmount lifecycle, after micro app unmounted, the react component might also be removed\n\n    if (phase !== 'unmounted') {\n      var errorMsg = function () {\n        switch (phase) {\n          case 'loading':\n          case 'mounting':\n            return \"[qiankun] Target container with \".concat(container, \" not existed while \").concat(appName, \" \").concat(phase, \"!\");\n\n          case 'mounted':\n            return \"[qiankun] Target container with \".concat(container, \" not existed after \").concat(appName, \" \").concat(phase, \"!\");\n\n          default:\n            return \"[qiankun] Target container with \".concat(container, \" not existed while \").concat(appName, \" rendering!\");\n        }\n      }();\n\n      assertElementExist(containerElement, errorMsg);\n    }\n\n    if (containerElement && !containerElement.contains(element)) {\n      // clear the container\n      while (containerElement.firstChild) {\n        rawRemoveChild.call(containerElement, containerElement.firstChild);\n      } // append the element to container if it exist\n\n\n      if (element) {\n        rawAppendChild.call(containerElement, element);\n      }\n    }\n\n    return undefined;\n  };\n\n  return render;\n}\n\nfunction getLifecyclesFromExports(scriptExports, appName, global, globalLatestSetProp) {\n  if (validateExportLifecycle(scriptExports)) {\n    return scriptExports;\n  } // fallback to sandbox latest set property if it had\n\n\n  if (globalLatestSetProp) {\n    var lifecycles = global[globalLatestSetProp];\n\n    if (validateExportLifecycle(lifecycles)) {\n      return lifecycles;\n    }\n  }\n\n  if (process.env.NODE_ENV === 'development') {\n    console.warn(\"[qiankun] lifecycle not found from \".concat(appName, \" entry exports, fallback to get from window['\").concat(appName, \"']\"));\n  } // fallback to global variable who named with ${appName} while module exports not found\n\n\n  var globalVariableExports = global[appName];\n\n  if (validateExportLifecycle(globalVariableExports)) {\n    return globalVariableExports;\n  }\n\n  throw new Error(\"[qiankun] You need to export lifecycle functions in \".concat(appName, \" entry\"));\n}\n\nvar prevAppUnmountedDeferred;\nexport function loadApp(app) {\n  var configuration = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var lifeCycles = arguments.length > 2 ? arguments[2] : undefined;\n\n  var _a;\n\n  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee16() {\n    var _this = this;\n\n    var entry, appName, appInstanceId, markName, _configuration$singul, singular, _configuration$sandbo, sandbox, excludeAssetFilter, importEntryOpts, _yield$importEntry, template, execScripts, assetPublicPath, appContent, strictStyleIsolation, scopedCSS, initialAppWrapperElement, initialContainer, legacyRender, render, initialAppWrapperGetter, global, mountSandbox, unmountSandbox, useLooseSandbox, sandboxContainer, _mergeWith, _mergeWith$beforeUnmo, beforeUnmount, _mergeWith$afterUnmou, afterUnmount, _mergeWith$afterMount, afterMount, _mergeWith$beforeMoun, beforeMount, _mergeWith$beforeLoad, beforeLoad, scriptExports, _getLifecyclesFromExp, bootstrap, mount, unmount, update, _getMicroAppStateActi, onGlobalStateChange, setGlobalState, offGlobalStateChange, syncAppWrapperElement2Sandbox, parcelConfigGetter;\n\n    return _regeneratorRuntime.wrap(function _callee16$(_context16) {\n      while (1) {\n        switch (_context16.prev = _context16.next) {\n          case 0:\n            entry = app.entry, appName = app.name;\n            appInstanceId = \"\".concat(appName, \"_\").concat(+new Date(), \"_\").concat(Math.floor(Math.random() * 1000));\n            markName = \"[qiankun] App \".concat(appInstanceId, \" Loading\");\n\n            if (process.env.NODE_ENV === 'development') {\n              performanceMark(markName);\n            }\n\n            _configuration$singul = configuration.singular, singular = _configuration$singul === void 0 ? false : _configuration$singul, _configuration$sandbo = configuration.sandbox, sandbox = _configuration$sandbo === void 0 ? true : _configuration$sandbo, excludeAssetFilter = configuration.excludeAssetFilter, importEntryOpts = __rest(configuration, [\"singular\", \"sandbox\", \"excludeAssetFilter\"]); // get the entry html content and script executor\n\n            _context16.next = 7;\n            return importEntry(entry, importEntryOpts);\n\n          case 7:\n            _yield$importEntry = _context16.sent;\n            template = _yield$importEntry.template;\n            execScripts = _yield$importEntry.execScripts;\n            assetPublicPath = _yield$importEntry.assetPublicPath;\n            _context16.next = 13;\n            return validateSingularMode(singular, app);\n\n          case 13:\n            if (!_context16.sent) {\n              _context16.next = 16;\n              break;\n            }\n\n            _context16.next = 16;\n            return prevAppUnmountedDeferred && prevAppUnmountedDeferred.promise;\n\n          case 16:\n            appContent = getDefaultTplWrapper(appInstanceId, appName)(template);\n            strictStyleIsolation = _typeof(sandbox) === 'object' && !!sandbox.strictStyleIsolation;\n            scopedCSS = isEnableScopedCSS(sandbox);\n            initialAppWrapperElement = createElement(appContent, strictStyleIsolation, scopedCSS, appName);\n            initialContainer = 'container' in app ? app.container : undefined;\n            legacyRender = 'render' in app ? app.render : undefined;\n            render = getRender(appName, appContent, legacyRender); // 第一次加载设置应用可见区域 dom 结构\n            // 确保每次应用加载前容器 dom 结构已经设置完毕\n\n            render({\n              element: initialAppWrapperElement,\n              loading: true,\n              container: initialContainer\n            }, 'loading');\n            initialAppWrapperGetter = getAppWrapperGetter(appName, appInstanceId, !!legacyRender, strictStyleIsolation, scopedCSS, function () {\n              return initialAppWrapperElement;\n            });\n            global = window;\n\n            mountSandbox = function mountSandbox() {\n              return Promise.resolve();\n            };\n\n            unmountSandbox = function unmountSandbox() {\n              return Promise.resolve();\n            };\n\n            useLooseSandbox = _typeof(sandbox) === 'object' && !!sandbox.loose;\n\n            if (sandbox) {\n              sandboxContainer = createSandboxContainer(appName, // FIXME should use a strict sandbox logic while remount, see https://github.com/umijs/qiankun/issues/518\n              initialAppWrapperGetter, scopedCSS, useLooseSandbox, excludeAssetFilter); // 用沙箱的代理对象作为接下来使用的全局对象\n\n              global = sandboxContainer.instance.proxy;\n              mountSandbox = sandboxContainer.mount;\n              unmountSandbox = sandboxContainer.unmount;\n            }\n\n            _mergeWith = _mergeWith2({}, getAddOns(global, assetPublicPath), lifeCycles, function (v1, v2) {\n              return _concat(v1 !== null && v1 !== void 0 ? v1 : [], v2 !== null && v2 !== void 0 ? v2 : []);\n            }), _mergeWith$beforeUnmo = _mergeWith.beforeUnmount, beforeUnmount = _mergeWith$beforeUnmo === void 0 ? [] : _mergeWith$beforeUnmo, _mergeWith$afterUnmou = _mergeWith.afterUnmount, afterUnmount = _mergeWith$afterUnmou === void 0 ? [] : _mergeWith$afterUnmou, _mergeWith$afterMount = _mergeWith.afterMount, afterMount = _mergeWith$afterMount === void 0 ? [] : _mergeWith$afterMount, _mergeWith$beforeMoun = _mergeWith.beforeMount, beforeMount = _mergeWith$beforeMoun === void 0 ? [] : _mergeWith$beforeMoun, _mergeWith$beforeLoad = _mergeWith.beforeLoad, beforeLoad = _mergeWith$beforeLoad === void 0 ? [] : _mergeWith$beforeLoad;\n            _context16.next = 33;\n            return execHooksChain(toArray(beforeLoad), app, global);\n\n          case 33:\n            _context16.next = 35;\n            return execScripts(global, !useLooseSandbox);\n\n          case 35:\n            scriptExports = _context16.sent;\n            _getLifecyclesFromExp = getLifecyclesFromExports(scriptExports, appName, global, (_a = sandboxContainer === null || sandboxContainer === void 0 ? void 0 : sandboxContainer.instance) === null || _a === void 0 ? void 0 : _a.latestSetProp), bootstrap = _getLifecyclesFromExp.bootstrap, mount = _getLifecyclesFromExp.mount, unmount = _getLifecyclesFromExp.unmount, update = _getLifecyclesFromExp.update;\n            _getMicroAppStateActi = getMicroAppStateActions(appInstanceId), onGlobalStateChange = _getMicroAppStateActi.onGlobalStateChange, setGlobalState = _getMicroAppStateActi.setGlobalState, offGlobalStateChange = _getMicroAppStateActi.offGlobalStateChange; // FIXME temporary way\n\n            syncAppWrapperElement2Sandbox = function syncAppWrapperElement2Sandbox(element) {\n              return initialAppWrapperElement = element;\n            };\n\n            parcelConfigGetter = function parcelConfigGetter() {\n              var remountContainer = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialContainer;\n              var appWrapperElement = initialAppWrapperElement;\n              var appWrapperGetter = getAppWrapperGetter(appName, appInstanceId, !!legacyRender, strictStyleIsolation, scopedCSS, function () {\n                return appWrapperElement;\n              });\n              var parcelConfig = {\n                name: appInstanceId,\n                bootstrap: bootstrap,\n                mount: [function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n                    var marks;\n                    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n                      while (1) {\n                        switch (_context2.prev = _context2.next) {\n                          case 0:\n                            if (process.env.NODE_ENV === 'development') {\n                              marks = performanceGetEntriesByName(markName, 'mark'); // mark length is zero means the app is remounting\n\n                              if (marks && !marks.length) {\n                                performanceMark(markName);\n                              }\n                            }\n\n                          case 1:\n                          case \"end\":\n                            return _context2.stop();\n                        }\n                      }\n                    }, _callee2);\n                  }));\n                }, function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n                    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n                      while (1) {\n                        switch (_context3.prev = _context3.next) {\n                          case 0:\n                            _context3.next = 2;\n                            return validateSingularMode(singular, app);\n\n                          case 2:\n                            _context3.t0 = _context3.sent;\n\n                            if (!_context3.t0) {\n                              _context3.next = 5;\n                              break;\n                            }\n\n                            _context3.t0 = prevAppUnmountedDeferred;\n\n                          case 5:\n                            if (!_context3.t0) {\n                              _context3.next = 7;\n                              break;\n                            }\n\n                            return _context3.abrupt(\"return\", prevAppUnmountedDeferred.promise);\n\n                          case 7:\n                            return _context3.abrupt(\"return\", undefined);\n\n                          case 8:\n                          case \"end\":\n                            return _context3.stop();\n                        }\n                      }\n                    }, _callee3);\n                  }));\n                }, // 添加 mount hook, 确保每次应用加载前容器 dom 结构已经设置完毕\n                function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n                    var useNewContainer;\n                    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n                      while (1) {\n                        switch (_context4.prev = _context4.next) {\n                          case 0:\n                            useNewContainer = remountContainer !== initialContainer;\n\n                            if (useNewContainer || !appWrapperElement) {\n                              // element will be destroyed after unmounted, we need to recreate it if it not exist\n                              // or we try to remount into a new container\n                              appWrapperElement = createElement(appContent, strictStyleIsolation, scopedCSS, appName);\n                              syncAppWrapperElement2Sandbox(appWrapperElement);\n                            }\n\n                            render({\n                              element: appWrapperElement,\n                              loading: true,\n                              container: remountContainer\n                            }, 'mounting');\n\n                          case 3:\n                          case \"end\":\n                            return _context4.stop();\n                        }\n                      }\n                    }, _callee4);\n                  }));\n                }, mountSandbox, // exec the chain after rendering to keep the behavior with beforeLoad\n                function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n                    return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n                      while (1) {\n                        switch (_context5.prev = _context5.next) {\n                          case 0:\n                            return _context5.abrupt(\"return\", execHooksChain(toArray(beforeMount), app, global));\n\n                          case 1:\n                          case \"end\":\n                            return _context5.stop();\n                        }\n                      }\n                    }, _callee5);\n                  }));\n                }, function (props) {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee6() {\n                    return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n                      while (1) {\n                        switch (_context6.prev = _context6.next) {\n                          case 0:\n                            return _context6.abrupt(\"return\", mount(Object.assign(Object.assign({}, props), {\n                              container: appWrapperGetter(),\n                              setGlobalState: setGlobalState,\n                              onGlobalStateChange: onGlobalStateChange\n                            })));\n\n                          case 1:\n                          case \"end\":\n                            return _context6.stop();\n                        }\n                      }\n                    }, _callee6);\n                  }));\n                }, // finish loading after app mounted\n                function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee7() {\n                    return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n                      while (1) {\n                        switch (_context7.prev = _context7.next) {\n                          case 0:\n                            return _context7.abrupt(\"return\", render({\n                              element: appWrapperElement,\n                              loading: false,\n                              container: remountContainer\n                            }, 'mounted'));\n\n                          case 1:\n                          case \"end\":\n                            return _context7.stop();\n                        }\n                      }\n                    }, _callee7);\n                  }));\n                }, function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee8() {\n                    return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n                      while (1) {\n                        switch (_context8.prev = _context8.next) {\n                          case 0:\n                            return _context8.abrupt(\"return\", execHooksChain(toArray(afterMount), app, global));\n\n                          case 1:\n                          case \"end\":\n                            return _context8.stop();\n                        }\n                      }\n                    }, _callee8);\n                  }));\n                }, // initialize the unmount defer after app mounted and resolve the defer after it unmounted\n                function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee9() {\n                    return _regeneratorRuntime.wrap(function _callee9$(_context9) {\n                      while (1) {\n                        switch (_context9.prev = _context9.next) {\n                          case 0:\n                            _context9.next = 2;\n                            return validateSingularMode(singular, app);\n\n                          case 2:\n                            if (!_context9.sent) {\n                              _context9.next = 4;\n                              break;\n                            }\n\n                            prevAppUnmountedDeferred = new Deferred();\n\n                          case 4:\n                          case \"end\":\n                            return _context9.stop();\n                        }\n                      }\n                    }, _callee9);\n                  }));\n                }, function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee10() {\n                    var measureName;\n                    return _regeneratorRuntime.wrap(function _callee10$(_context10) {\n                      while (1) {\n                        switch (_context10.prev = _context10.next) {\n                          case 0:\n                            if (process.env.NODE_ENV === 'development') {\n                              measureName = \"[qiankun] App \".concat(appInstanceId, \" Loading Consuming\");\n                              performanceMeasure(measureName, markName);\n                            }\n\n                          case 1:\n                          case \"end\":\n                            return _context10.stop();\n                        }\n                      }\n                    }, _callee10);\n                  }));\n                }],\n                unmount: [function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee11() {\n                    return _regeneratorRuntime.wrap(function _callee11$(_context11) {\n                      while (1) {\n                        switch (_context11.prev = _context11.next) {\n                          case 0:\n                            return _context11.abrupt(\"return\", execHooksChain(toArray(beforeUnmount), app, global));\n\n                          case 1:\n                          case \"end\":\n                            return _context11.stop();\n                        }\n                      }\n                    }, _callee11);\n                  }));\n                }, function (props) {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee12() {\n                    return _regeneratorRuntime.wrap(function _callee12$(_context12) {\n                      while (1) {\n                        switch (_context12.prev = _context12.next) {\n                          case 0:\n                            return _context12.abrupt(\"return\", unmount(Object.assign(Object.assign({}, props), {\n                              container: appWrapperGetter()\n                            })));\n\n                          case 1:\n                          case \"end\":\n                            return _context12.stop();\n                        }\n                      }\n                    }, _callee12);\n                  }));\n                }, unmountSandbox, function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee13() {\n                    return _regeneratorRuntime.wrap(function _callee13$(_context13) {\n                      while (1) {\n                        switch (_context13.prev = _context13.next) {\n                          case 0:\n                            return _context13.abrupt(\"return\", execHooksChain(toArray(afterUnmount), app, global));\n\n                          case 1:\n                          case \"end\":\n                            return _context13.stop();\n                        }\n                      }\n                    }, _callee13);\n                  }));\n                }, function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee14() {\n                    return _regeneratorRuntime.wrap(function _callee14$(_context14) {\n                      while (1) {\n                        switch (_context14.prev = _context14.next) {\n                          case 0:\n                            render({\n                              element: null,\n                              loading: false,\n                              container: remountContainer\n                            }, 'unmounted');\n                            offGlobalStateChange(appInstanceId); // for gc\n\n                            appWrapperElement = null;\n                            syncAppWrapperElement2Sandbox(appWrapperElement);\n\n                          case 4:\n                          case \"end\":\n                            return _context14.stop();\n                        }\n                      }\n                    }, _callee14);\n                  }));\n                }, function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee15() {\n                    return _regeneratorRuntime.wrap(function _callee15$(_context15) {\n                      while (1) {\n                        switch (_context15.prev = _context15.next) {\n                          case 0:\n                            _context15.next = 2;\n                            return validateSingularMode(singular, app);\n\n                          case 2:\n                            _context15.t0 = _context15.sent;\n\n                            if (!_context15.t0) {\n                              _context15.next = 5;\n                              break;\n                            }\n\n                            _context15.t0 = prevAppUnmountedDeferred;\n\n                          case 5:\n                            if (!_context15.t0) {\n                              _context15.next = 7;\n                              break;\n                            }\n\n                            prevAppUnmountedDeferred.resolve();\n\n                          case 7:\n                          case \"end\":\n                            return _context15.stop();\n                        }\n                      }\n                    }, _callee15);\n                  }));\n                }]\n              };\n\n              if (typeof update === 'function') {\n                parcelConfig.update = update;\n              }\n\n              return parcelConfig;\n            };\n\n            return _context16.abrupt(\"return\", parcelConfigGetter);\n\n          case 41:\n          case \"end\":\n            return _context16.stop();\n        }\n      }\n    }, _callee16);\n  }));\n}","map":{"version":3,"sources":["/Users/mory/Desktop/qiankun-react/master/node_modules/qiankun/es/loader.js"],"names":["_concat","_mergeWith2","_typeof","_forEach","_regeneratorRuntime","__awaiter","__rest","importEntry","getAddOns","getMicroAppStateActions","createSandboxContainer","css","Deferred","getContainer","getDefaultTplWrapper","getWrapperId","isEnableScopedCSS","performanceMark","performanceMeasure","performanceGetEntriesByName","toArray","validateExportLifecycle","assertElementExist","element","msg","Error","execHooksChain","hooks","app","global","arguments","length","undefined","window","reduce","chain","hook","then","Promise","resolve","validateSingularMode","validate","mark","_callee","wrap","_callee$","_context","prev","next","abrupt","stop","supportShadowDOM","document","head","attachShadow","createShadowRoot","createElement","appContent","strictStyleIsolation","scopedCSS","appName","containerElement","innerHTML","appElement","firstChild","console","warn","shadow","mode","attr","getAttribute","QiankunCSSRewriteAttr","setAttribute","styleNodes","querySelectorAll","stylesheetElement","process","getAppWrapperGetter","appInstanceId","useLegacyRender","elementGetter","appWrapper","getElementById","concat","shadowRoot","rawAppendChild","HTMLElement","prototype","appendChild","rawRemoveChild","removeChild","getRender","legacyRender","render","_ref","phase","loading","container","env","NODE_ENV","errorMsg","contains","call","getLifecyclesFromExports","scriptExports","globalLatestSetProp","lifecycles","globalVariableExports","prevAppUnmountedDeferred","loadApp","configuration","lifeCycles","_a","_callee16","_this","entry","markName","_configuration$singul","singular","_configuration$sandbo","sandbox","excludeAssetFilter","importEntryOpts","_yield$importEntry","template","execScripts","assetPublicPath","initialAppWrapperElement","initialContainer","initialAppWrapperGetter","mountSandbox","unmountSandbox","useLooseSandbox","sandboxContainer","_mergeWith","_mergeWith$beforeUnmo","beforeUnmount","_mergeWith$afterUnmou","afterUnmount","_mergeWith$afterMount","afterMount","_mergeWith$beforeMoun","beforeMount","_mergeWith$beforeLoad","beforeLoad","_getLifecyclesFromExp","bootstrap","mount","unmount","update","_getMicroAppStateActi","onGlobalStateChange","setGlobalState","offGlobalStateChange","syncAppWrapperElement2Sandbox","parcelConfigGetter","_callee16$","_context16","name","Date","Math","floor","random","sent","promise","loose","instance","proxy","v1","v2","latestSetProp","remountContainer","appWrapperElement","appWrapperGetter","parcelConfig","_callee2","marks","_callee2$","_context2","_callee3","_callee3$","_context3","t0","_callee4","useNewContainer","_callee4$","_context4","_callee5","_callee5$","_context5","props","_callee6","_callee6$","_context6","Object","assign","_callee7","_callee7$","_context7","_callee8","_callee8$","_context8","_callee9","_callee9$","_context9","_callee10","measureName","_callee10$","_context10","_callee11","_callee11$","_context11","_callee12","_callee12$","_context12","_callee13","_callee13$","_context13","_callee14","_callee14$","_context14","_callee15","_callee15$","_context15"],"mappings":"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","sourcesContent":["import _concat from \"lodash/concat\";\nimport _mergeWith2 from \"lodash/mergeWith\";\nimport _typeof from \"@babel/runtime/helpers/esm/typeof\";\nimport _forEach from \"lodash/forEach\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\n/**\n * @author Kuitos\n * @since 2020-04-01\n */\nimport { __awaiter, __rest } from \"tslib\";\nimport { importEntry } from 'import-html-entry';\nimport getAddOns from './addons';\nimport { getMicroAppStateActions } from './globalState';\nimport { createSandboxContainer, css } from './sandbox';\nimport { Deferred, getContainer, getDefaultTplWrapper, getWrapperId, isEnableScopedCSS, performanceMark, performanceMeasure, performanceGetEntriesByName, toArray, validateExportLifecycle } from './utils';\n\nfunction assertElementExist(element, msg) {\n  if (!element) {\n    if (msg) {\n      throw new Error(msg);\n    }\n\n    throw new Error('[qiankun] element not existed!');\n  }\n}\n\nfunction execHooksChain(hooks, app) {\n  var global = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : window;\n\n  if (hooks.length) {\n    return hooks.reduce(function (chain, hook) {\n      return chain.then(function () {\n        return hook(app, global);\n      });\n    }, Promise.resolve());\n  }\n\n  return Promise.resolve();\n}\n\nfunction validateSingularMode(validate, app) {\n  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            return _context.abrupt(\"return\", typeof validate === 'function' ? validate(app) : !!validate);\n\n          case 1:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n} // @ts-ignore\n\n\nvar supportShadowDOM = document.head.attachShadow || document.head.createShadowRoot;\n\nfunction createElement(appContent, strictStyleIsolation, scopedCSS, appName) {\n  var containerElement = document.createElement('div');\n  containerElement.innerHTML = appContent; // appContent always wrapped with a singular div\n\n  var appElement = containerElement.firstChild;\n\n  if (strictStyleIsolation) {\n    if (!supportShadowDOM) {\n      console.warn('[qiankun]: As current browser not support shadow dom, your strictStyleIsolation configuration will be ignored!');\n    } else {\n      var innerHTML = appElement.innerHTML;\n      appElement.innerHTML = '';\n      var shadow;\n\n      if (appElement.attachShadow) {\n        shadow = appElement.attachShadow({\n          mode: 'open'\n        });\n      } else {\n        // createShadowRoot was proposed in initial spec, which has then been deprecated\n        shadow = appElement.createShadowRoot();\n      }\n\n      shadow.innerHTML = innerHTML;\n    }\n  }\n\n  if (scopedCSS) {\n    var attr = appElement.getAttribute(css.QiankunCSSRewriteAttr);\n\n    if (!attr) {\n      appElement.setAttribute(css.QiankunCSSRewriteAttr, appName);\n    }\n\n    var styleNodes = appElement.querySelectorAll('style') || [];\n\n    _forEach(styleNodes, function (stylesheetElement) {\n      css.process(appElement, stylesheetElement, appName);\n    });\n  }\n\n  return appElement;\n}\n/** generate app wrapper dom getter */\n\n\nfunction getAppWrapperGetter(appName, appInstanceId, useLegacyRender, strictStyleIsolation, scopedCSS, elementGetter) {\n  return function () {\n    if (useLegacyRender) {\n      if (strictStyleIsolation) throw new Error('[qiankun]: strictStyleIsolation can not be used with legacy render!');\n      if (scopedCSS) throw new Error('[qiankun]: experimentalStyleIsolation can not be used with legacy render!');\n      var appWrapper = document.getElementById(getWrapperId(appInstanceId));\n      assertElementExist(appWrapper, \"[qiankun] Wrapper element for \".concat(appName, \" with instance \").concat(appInstanceId, \" is not existed!\"));\n      return appWrapper;\n    }\n\n    var element = elementGetter();\n    assertElementExist(element, \"[qiankun] Wrapper element for \".concat(appName, \" with instance \").concat(appInstanceId, \" is not existed!\"));\n\n    if (strictStyleIsolation) {\n      return element.shadowRoot;\n    }\n\n    return element;\n  };\n}\n\nvar rawAppendChild = HTMLElement.prototype.appendChild;\nvar rawRemoveChild = HTMLElement.prototype.removeChild;\n/**\n * Get the render function\n * If the legacy render function is provide, used as it, otherwise we will insert the app element to target container by qiankun\n * @param appName\n * @param appContent\n * @param legacyRender\n */\n\nfunction getRender(appName, appContent, legacyRender) {\n  var render = function render(_ref, phase) {\n    var element = _ref.element,\n        loading = _ref.loading,\n        container = _ref.container;\n\n    if (legacyRender) {\n      if (process.env.NODE_ENV === 'development') {\n        console.warn('[qiankun] Custom rendering function is deprecated, you can use the container element setting instead!');\n      }\n\n      return legacyRender({\n        loading: loading,\n        appContent: element ? appContent : ''\n      });\n    }\n\n    var containerElement = getContainer(container); // The container might have be removed after micro app unmounted.\n    // Such as the micro app unmount lifecycle called by a react componentWillUnmount lifecycle, after micro app unmounted, the react component might also be removed\n\n    if (phase !== 'unmounted') {\n      var errorMsg = function () {\n        switch (phase) {\n          case 'loading':\n          case 'mounting':\n            return \"[qiankun] Target container with \".concat(container, \" not existed while \").concat(appName, \" \").concat(phase, \"!\");\n\n          case 'mounted':\n            return \"[qiankun] Target container with \".concat(container, \" not existed after \").concat(appName, \" \").concat(phase, \"!\");\n\n          default:\n            return \"[qiankun] Target container with \".concat(container, \" not existed while \").concat(appName, \" rendering!\");\n        }\n      }();\n\n      assertElementExist(containerElement, errorMsg);\n    }\n\n    if (containerElement && !containerElement.contains(element)) {\n      // clear the container\n      while (containerElement.firstChild) {\n        rawRemoveChild.call(containerElement, containerElement.firstChild);\n      } // append the element to container if it exist\n\n\n      if (element) {\n        rawAppendChild.call(containerElement, element);\n      }\n    }\n\n    return undefined;\n  };\n\n  return render;\n}\n\nfunction getLifecyclesFromExports(scriptExports, appName, global, globalLatestSetProp) {\n  if (validateExportLifecycle(scriptExports)) {\n    return scriptExports;\n  } // fallback to sandbox latest set property if it had\n\n\n  if (globalLatestSetProp) {\n    var lifecycles = global[globalLatestSetProp];\n\n    if (validateExportLifecycle(lifecycles)) {\n      return lifecycles;\n    }\n  }\n\n  if (process.env.NODE_ENV === 'development') {\n    console.warn(\"[qiankun] lifecycle not found from \".concat(appName, \" entry exports, fallback to get from window['\").concat(appName, \"']\"));\n  } // fallback to global variable who named with ${appName} while module exports not found\n\n\n  var globalVariableExports = global[appName];\n\n  if (validateExportLifecycle(globalVariableExports)) {\n    return globalVariableExports;\n  }\n\n  throw new Error(\"[qiankun] You need to export lifecycle functions in \".concat(appName, \" entry\"));\n}\n\nvar prevAppUnmountedDeferred;\nexport function loadApp(app) {\n  var configuration = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var lifeCycles = arguments.length > 2 ? arguments[2] : undefined;\n\n  var _a;\n\n  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee16() {\n    var _this = this;\n\n    var entry, appName, appInstanceId, markName, _configuration$singul, singular, _configuration$sandbo, sandbox, excludeAssetFilter, importEntryOpts, _yield$importEntry, template, execScripts, assetPublicPath, appContent, strictStyleIsolation, scopedCSS, initialAppWrapperElement, initialContainer, legacyRender, render, initialAppWrapperGetter, global, mountSandbox, unmountSandbox, useLooseSandbox, sandboxContainer, _mergeWith, _mergeWith$beforeUnmo, beforeUnmount, _mergeWith$afterUnmou, afterUnmount, _mergeWith$afterMount, afterMount, _mergeWith$beforeMoun, beforeMount, _mergeWith$beforeLoad, beforeLoad, scriptExports, _getLifecyclesFromExp, bootstrap, mount, unmount, update, _getMicroAppStateActi, onGlobalStateChange, setGlobalState, offGlobalStateChange, syncAppWrapperElement2Sandbox, parcelConfigGetter;\n\n    return _regeneratorRuntime.wrap(function _callee16$(_context16) {\n      while (1) {\n        switch (_context16.prev = _context16.next) {\n          case 0:\n            entry = app.entry, appName = app.name;\n            appInstanceId = \"\".concat(appName, \"_\").concat(+new Date(), \"_\").concat(Math.floor(Math.random() * 1000));\n            markName = \"[qiankun] App \".concat(appInstanceId, \" Loading\");\n\n            if (process.env.NODE_ENV === 'development') {\n              performanceMark(markName);\n            }\n\n            _configuration$singul = configuration.singular, singular = _configuration$singul === void 0 ? false : _configuration$singul, _configuration$sandbo = configuration.sandbox, sandbox = _configuration$sandbo === void 0 ? true : _configuration$sandbo, excludeAssetFilter = configuration.excludeAssetFilter, importEntryOpts = __rest(configuration, [\"singular\", \"sandbox\", \"excludeAssetFilter\"]); // get the entry html content and script executor\n\n            _context16.next = 7;\n            return importEntry(entry, importEntryOpts);\n\n          case 7:\n            _yield$importEntry = _context16.sent;\n            template = _yield$importEntry.template;\n            execScripts = _yield$importEntry.execScripts;\n            assetPublicPath = _yield$importEntry.assetPublicPath;\n            _context16.next = 13;\n            return validateSingularMode(singular, app);\n\n          case 13:\n            if (!_context16.sent) {\n              _context16.next = 16;\n              break;\n            }\n\n            _context16.next = 16;\n            return prevAppUnmountedDeferred && prevAppUnmountedDeferred.promise;\n\n          case 16:\n            appContent = getDefaultTplWrapper(appInstanceId, appName)(template);\n            strictStyleIsolation = _typeof(sandbox) === 'object' && !!sandbox.strictStyleIsolation;\n            scopedCSS = isEnableScopedCSS(sandbox);\n            initialAppWrapperElement = createElement(appContent, strictStyleIsolation, scopedCSS, appName);\n            initialContainer = 'container' in app ? app.container : undefined;\n            legacyRender = 'render' in app ? app.render : undefined;\n            render = getRender(appName, appContent, legacyRender); // 第一次加载设置应用可见区域 dom 结构\n            // 确保每次应用加载前容器 dom 结构已经设置完毕\n\n            render({\n              element: initialAppWrapperElement,\n              loading: true,\n              container: initialContainer\n            }, 'loading');\n            initialAppWrapperGetter = getAppWrapperGetter(appName, appInstanceId, !!legacyRender, strictStyleIsolation, scopedCSS, function () {\n              return initialAppWrapperElement;\n            });\n            global = window;\n\n            mountSandbox = function mountSandbox() {\n              return Promise.resolve();\n            };\n\n            unmountSandbox = function unmountSandbox() {\n              return Promise.resolve();\n            };\n\n            useLooseSandbox = _typeof(sandbox) === 'object' && !!sandbox.loose;\n\n            if (sandbox) {\n              sandboxContainer = createSandboxContainer(appName, // FIXME should use a strict sandbox logic while remount, see https://github.com/umijs/qiankun/issues/518\n              initialAppWrapperGetter, scopedCSS, useLooseSandbox, excludeAssetFilter); // 用沙箱的代理对象作为接下来使用的全局对象\n\n              global = sandboxContainer.instance.proxy;\n              mountSandbox = sandboxContainer.mount;\n              unmountSandbox = sandboxContainer.unmount;\n            }\n\n            _mergeWith = _mergeWith2({}, getAddOns(global, assetPublicPath), lifeCycles, function (v1, v2) {\n              return _concat(v1 !== null && v1 !== void 0 ? v1 : [], v2 !== null && v2 !== void 0 ? v2 : []);\n            }), _mergeWith$beforeUnmo = _mergeWith.beforeUnmount, beforeUnmount = _mergeWith$beforeUnmo === void 0 ? [] : _mergeWith$beforeUnmo, _mergeWith$afterUnmou = _mergeWith.afterUnmount, afterUnmount = _mergeWith$afterUnmou === void 0 ? [] : _mergeWith$afterUnmou, _mergeWith$afterMount = _mergeWith.afterMount, afterMount = _mergeWith$afterMount === void 0 ? [] : _mergeWith$afterMount, _mergeWith$beforeMoun = _mergeWith.beforeMount, beforeMount = _mergeWith$beforeMoun === void 0 ? [] : _mergeWith$beforeMoun, _mergeWith$beforeLoad = _mergeWith.beforeLoad, beforeLoad = _mergeWith$beforeLoad === void 0 ? [] : _mergeWith$beforeLoad;\n            _context16.next = 33;\n            return execHooksChain(toArray(beforeLoad), app, global);\n\n          case 33:\n            _context16.next = 35;\n            return execScripts(global, !useLooseSandbox);\n\n          case 35:\n            scriptExports = _context16.sent;\n            _getLifecyclesFromExp = getLifecyclesFromExports(scriptExports, appName, global, (_a = sandboxContainer === null || sandboxContainer === void 0 ? void 0 : sandboxContainer.instance) === null || _a === void 0 ? void 0 : _a.latestSetProp), bootstrap = _getLifecyclesFromExp.bootstrap, mount = _getLifecyclesFromExp.mount, unmount = _getLifecyclesFromExp.unmount, update = _getLifecyclesFromExp.update;\n            _getMicroAppStateActi = getMicroAppStateActions(appInstanceId), onGlobalStateChange = _getMicroAppStateActi.onGlobalStateChange, setGlobalState = _getMicroAppStateActi.setGlobalState, offGlobalStateChange = _getMicroAppStateActi.offGlobalStateChange; // FIXME temporary way\n\n            syncAppWrapperElement2Sandbox = function syncAppWrapperElement2Sandbox(element) {\n              return initialAppWrapperElement = element;\n            };\n\n            parcelConfigGetter = function parcelConfigGetter() {\n              var remountContainer = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialContainer;\n              var appWrapperElement = initialAppWrapperElement;\n              var appWrapperGetter = getAppWrapperGetter(appName, appInstanceId, !!legacyRender, strictStyleIsolation, scopedCSS, function () {\n                return appWrapperElement;\n              });\n              var parcelConfig = {\n                name: appInstanceId,\n                bootstrap: bootstrap,\n                mount: [function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n                    var marks;\n                    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n                      while (1) {\n                        switch (_context2.prev = _context2.next) {\n                          case 0:\n                            if (process.env.NODE_ENV === 'development') {\n                              marks = performanceGetEntriesByName(markName, 'mark'); // mark length is zero means the app is remounting\n\n                              if (marks && !marks.length) {\n                                performanceMark(markName);\n                              }\n                            }\n\n                          case 1:\n                          case \"end\":\n                            return _context2.stop();\n                        }\n                      }\n                    }, _callee2);\n                  }));\n                }, function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n                    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n                      while (1) {\n                        switch (_context3.prev = _context3.next) {\n                          case 0:\n                            _context3.next = 2;\n                            return validateSingularMode(singular, app);\n\n                          case 2:\n                            _context3.t0 = _context3.sent;\n\n                            if (!_context3.t0) {\n                              _context3.next = 5;\n                              break;\n                            }\n\n                            _context3.t0 = prevAppUnmountedDeferred;\n\n                          case 5:\n                            if (!_context3.t0) {\n                              _context3.next = 7;\n                              break;\n                            }\n\n                            return _context3.abrupt(\"return\", prevAppUnmountedDeferred.promise);\n\n                          case 7:\n                            return _context3.abrupt(\"return\", undefined);\n\n                          case 8:\n                          case \"end\":\n                            return _context3.stop();\n                        }\n                      }\n                    }, _callee3);\n                  }));\n                }, // 添加 mount hook, 确保每次应用加载前容器 dom 结构已经设置完毕\n                function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n                    var useNewContainer;\n                    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n                      while (1) {\n                        switch (_context4.prev = _context4.next) {\n                          case 0:\n                            useNewContainer = remountContainer !== initialContainer;\n\n                            if (useNewContainer || !appWrapperElement) {\n                              // element will be destroyed after unmounted, we need to recreate it if it not exist\n                              // or we try to remount into a new container\n                              appWrapperElement = createElement(appContent, strictStyleIsolation, scopedCSS, appName);\n                              syncAppWrapperElement2Sandbox(appWrapperElement);\n                            }\n\n                            render({\n                              element: appWrapperElement,\n                              loading: true,\n                              container: remountContainer\n                            }, 'mounting');\n\n                          case 3:\n                          case \"end\":\n                            return _context4.stop();\n                        }\n                      }\n                    }, _callee4);\n                  }));\n                }, mountSandbox, // exec the chain after rendering to keep the behavior with beforeLoad\n                function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n                    return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n                      while (1) {\n                        switch (_context5.prev = _context5.next) {\n                          case 0:\n                            return _context5.abrupt(\"return\", execHooksChain(toArray(beforeMount), app, global));\n\n                          case 1:\n                          case \"end\":\n                            return _context5.stop();\n                        }\n                      }\n                    }, _callee5);\n                  }));\n                }, function (props) {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee6() {\n                    return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n                      while (1) {\n                        switch (_context6.prev = _context6.next) {\n                          case 0:\n                            return _context6.abrupt(\"return\", mount(Object.assign(Object.assign({}, props), {\n                              container: appWrapperGetter(),\n                              setGlobalState: setGlobalState,\n                              onGlobalStateChange: onGlobalStateChange\n                            })));\n\n                          case 1:\n                          case \"end\":\n                            return _context6.stop();\n                        }\n                      }\n                    }, _callee6);\n                  }));\n                }, // finish loading after app mounted\n                function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee7() {\n                    return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n                      while (1) {\n                        switch (_context7.prev = _context7.next) {\n                          case 0:\n                            return _context7.abrupt(\"return\", render({\n                              element: appWrapperElement,\n                              loading: false,\n                              container: remountContainer\n                            }, 'mounted'));\n\n                          case 1:\n                          case \"end\":\n                            return _context7.stop();\n                        }\n                      }\n                    }, _callee7);\n                  }));\n                }, function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee8() {\n                    return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n                      while (1) {\n                        switch (_context8.prev = _context8.next) {\n                          case 0:\n                            return _context8.abrupt(\"return\", execHooksChain(toArray(afterMount), app, global));\n\n                          case 1:\n                          case \"end\":\n                            return _context8.stop();\n                        }\n                      }\n                    }, _callee8);\n                  }));\n                }, // initialize the unmount defer after app mounted and resolve the defer after it unmounted\n                function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee9() {\n                    return _regeneratorRuntime.wrap(function _callee9$(_context9) {\n                      while (1) {\n                        switch (_context9.prev = _context9.next) {\n                          case 0:\n                            _context9.next = 2;\n                            return validateSingularMode(singular, app);\n\n                          case 2:\n                            if (!_context9.sent) {\n                              _context9.next = 4;\n                              break;\n                            }\n\n                            prevAppUnmountedDeferred = new Deferred();\n\n                          case 4:\n                          case \"end\":\n                            return _context9.stop();\n                        }\n                      }\n                    }, _callee9);\n                  }));\n                }, function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee10() {\n                    var measureName;\n                    return _regeneratorRuntime.wrap(function _callee10$(_context10) {\n                      while (1) {\n                        switch (_context10.prev = _context10.next) {\n                          case 0:\n                            if (process.env.NODE_ENV === 'development') {\n                              measureName = \"[qiankun] App \".concat(appInstanceId, \" Loading Consuming\");\n                              performanceMeasure(measureName, markName);\n                            }\n\n                          case 1:\n                          case \"end\":\n                            return _context10.stop();\n                        }\n                      }\n                    }, _callee10);\n                  }));\n                }],\n                unmount: [function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee11() {\n                    return _regeneratorRuntime.wrap(function _callee11$(_context11) {\n                      while (1) {\n                        switch (_context11.prev = _context11.next) {\n                          case 0:\n                            return _context11.abrupt(\"return\", execHooksChain(toArray(beforeUnmount), app, global));\n\n                          case 1:\n                          case \"end\":\n                            return _context11.stop();\n                        }\n                      }\n                    }, _callee11);\n                  }));\n                }, function (props) {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee12() {\n                    return _regeneratorRuntime.wrap(function _callee12$(_context12) {\n                      while (1) {\n                        switch (_context12.prev = _context12.next) {\n                          case 0:\n                            return _context12.abrupt(\"return\", unmount(Object.assign(Object.assign({}, props), {\n                              container: appWrapperGetter()\n                            })));\n\n                          case 1:\n                          case \"end\":\n                            return _context12.stop();\n                        }\n                      }\n                    }, _callee12);\n                  }));\n                }, unmountSandbox, function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee13() {\n                    return _regeneratorRuntime.wrap(function _callee13$(_context13) {\n                      while (1) {\n                        switch (_context13.prev = _context13.next) {\n                          case 0:\n                            return _context13.abrupt(\"return\", execHooksChain(toArray(afterUnmount), app, global));\n\n                          case 1:\n                          case \"end\":\n                            return _context13.stop();\n                        }\n                      }\n                    }, _callee13);\n                  }));\n                }, function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee14() {\n                    return _regeneratorRuntime.wrap(function _callee14$(_context14) {\n                      while (1) {\n                        switch (_context14.prev = _context14.next) {\n                          case 0:\n                            render({\n                              element: null,\n                              loading: false,\n                              container: remountContainer\n                            }, 'unmounted');\n                            offGlobalStateChange(appInstanceId); // for gc\n\n                            appWrapperElement = null;\n                            syncAppWrapperElement2Sandbox(appWrapperElement);\n\n                          case 4:\n                          case \"end\":\n                            return _context14.stop();\n                        }\n                      }\n                    }, _callee14);\n                  }));\n                }, function () {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee15() {\n                    return _regeneratorRuntime.wrap(function _callee15$(_context15) {\n                      while (1) {\n                        switch (_context15.prev = _context15.next) {\n                          case 0:\n                            _context15.next = 2;\n                            return validateSingularMode(singular, app);\n\n                          case 2:\n                            _context15.t0 = _context15.sent;\n\n                            if (!_context15.t0) {\n                              _context15.next = 5;\n                              break;\n                            }\n\n                            _context15.t0 = prevAppUnmountedDeferred;\n\n                          case 5:\n                            if (!_context15.t0) {\n                              _context15.next = 7;\n                              break;\n                            }\n\n                            prevAppUnmountedDeferred.resolve();\n\n                          case 7:\n                          case \"end\":\n                            return _context15.stop();\n                        }\n                      }\n                    }, _callee15);\n                  }));\n                }]\n              };\n\n              if (typeof update === 'function') {\n                parcelConfig.update = update;\n              }\n\n              return parcelConfig;\n            };\n\n            return _context16.abrupt(\"return\", parcelConfigGetter);\n\n          case 41:\n          case \"end\":\n            return _context16.stop();\n        }\n      }\n    }, _callee16);\n  }));\n}"]},"metadata":{},"sourceType":"module"}