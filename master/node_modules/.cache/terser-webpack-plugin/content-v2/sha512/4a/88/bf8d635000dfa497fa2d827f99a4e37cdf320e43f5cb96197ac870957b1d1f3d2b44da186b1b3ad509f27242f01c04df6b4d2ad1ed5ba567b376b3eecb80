{"code":"!function(n,e){\"object\"===typeof exports&&\"object\"===typeof module?module.exports=e():\"function\"===typeof define&&define.amd?define([],e):\"object\"===typeof exports?exports[\"main-main\"]=e():n[\"main-main\"]=e()}(window,(function(){return(window.webpackJsonp_main=window.webpackJsonp_main||[]).push([[0],{175:function(n,e,t){\"use strict\";t.r(e);var a=t(4),o=(t(17),t(65)),c=t.n(o);t(74),t(75);var r=function(n){var e=n.content,t=n.loading;function o(n,e){window.history.pushState({},n,e)}return Object(a.jsxs)(\"div\",{className:\"App\",style:{display:\"flex\"},children:[Object(a.jsxs)(\"div\",{style:{width:100},children:[Object(a.jsx)(\"button\",{onClick:function(){return o(\"react1\",\"/react1\")},children:\"react1\"}),Object(a.jsx)(\"button\",{onClick:function(){return o(\"react2\",\"/react2\")},children:\"react2\"})]}),Object(a.jsxs)(\"div\",{style:{flexGrow:1},children:[t&&Object(a.jsx)(\"div\",{className:\"mask\",children:\"loading...\"}),Object(a.jsx)(\"div\",{dangerouslySetInnerHTML:{__html:e}})]})]})},i=t(178),s=t(3);var l=t(5),u=t(1),d=t.n(u),f={},h={};function b(n,e){Object.keys(h).forEach((function(t){h[t]instanceof Function&&h[t](d()(n),d()(e))}))}function p(n,e){return{onGlobalStateChange:function(e,t){if(e instanceof Function){h[n]&&console.warn(\"[qiankun] '\".concat(n,\"' global listener already exists before this, new listener will overwrite it.\")),h[n]=e;var a=d()(f);t&&e(a,a)}else console.error(\"[qiankun] callback must be function!\")},setGlobalState:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(n===f)return console.warn(\"[qiankun] state has not changed\\uff01\"),!1;var t=[],a=d()(f);return f=d()(Object.keys(n).reduce((function(a,o){return e||a.hasOwnProperty(o)?(t.push(o),Object.assign(a,Object(l.a)({},o,n[o]))):(console.warn(\"[qiankun] '\".concat(o,\"' not declared when init state\\uff01\")),a)}),f)),0===t.length?(console.warn(\"[qiankun] state has not changed\\uff01\"),!1):(b(f,a),!0)},offGlobalStateChange:function(){return delete h[n],!0}}}function g(n){var e=n.appContent,t=n.loading,o=document.getElementById(\"root\");c.a.render(Object(a.jsx)(r,{loading:t,content:e}),o)}function j(n){return function(e){return e.pathname.startsWith(n)}}g({loading:!0}),Object(i.b)([{name:\"react1\",entry:\"//localhost:6651\",render:g,activeRule:j(\"/react1\")},{name:\"react2\",entry:\"//localhost:6652\",render:g,activeRule:j(\"/react2\")}]);var w,m=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(n===f)console.warn(\"[qiankun] state has not changed\\uff01\");else{var e=d()(f);b(f=d()(n),e)}return p(\"global-\".concat(+new Date),!0)}({user:\"qiankun\"}),v=m.onGlobalStateChange,y=m.setGlobalState;v((function(n,e){return console.log(\"[onGlobalStateChange - master]:\",n,e)})),y({ignore:\"master\",user:{name:\"master\"}}),w=\"/react1\",window.addEventListener(\"single-spa:no-app-change\",(function n(){Object(s.d)().length||Object(s.f)(w),window.removeEventListener(\"single-spa:no-app-change\",n)})),Object(i.c)()},74:function(n,e,t){},75:function(n,e,t){}},[[175,1,2]]])}));","name":"static/js/main.13455999.chunk.js","map":{"version":3,"sources":["static/js/main.13455999.chunk.js"],"names":["root","factory","exports","module","define","amd","window","push","175","__webpack_exports__","__webpack_require__","r","jsx_runtime","react_dom","react_dom_default","n","src_App","props","content","loading","goto","title","href","history","pushState","Object","className","style","display","children","width","onClick","flexGrow","dangerouslySetInnerHTML","__html","apis","single_spa_min","defineProperty","cloneDeep","cloneDeep_default","globalState","deps","emitGlobal","state","prevState","keys","forEach","id","Function","getMicroAppStateActions","isMaster","onGlobalStateChange","callback","fireImmediately","console","warn","concat","cloneState","error","setGlobalState","arguments","length","undefined","changeKeys","prevGlobalState","reduce","_globalState","changeKey","hasOwnProperty","assign","offGlobalStateChange","render","_ref","appContent","container","document","getElementById","a","genActiveRule","routerPrefix","location","pathname","startsWith","name","entry","activeRule","defaultAppLink","_initGlobalState","Date","initGlobalState","user","src_onGlobalStateChange","src_setGlobalState","value","prev","log","ignore","addEventListener","listener","removeEventListener","74","75"],"mappings":"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"},"input":"(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"main-main\"] = factory();\n\telse\n\t\troot[\"main-main\"] = factory();\n})(window, function() {\nreturn (window[\"webpackJsonp_main\"] = window[\"webpackJsonp_main\"] || []).push([[0],{\n\n/***/ 175:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// EXTERNAL MODULE: ./node_modules/react/jsx-runtime.js\nvar jsx_runtime = __webpack_require__(4);\n\n// EXTERNAL MODULE: ./node_modules/react/index.js\nvar react = __webpack_require__(17);\n\n// EXTERNAL MODULE: ./node_modules/react-dom/index.js\nvar react_dom = __webpack_require__(65);\nvar react_dom_default = /*#__PURE__*/__webpack_require__.n(react_dom);\n\n// EXTERNAL MODULE: ./src/index.css\nvar src = __webpack_require__(74);\n\n// EXTERNAL MODULE: ./src/App.css\nvar App = __webpack_require__(75);\n\n// CONCATENATED MODULE: ./src/App.js\n/*\n * @Author: your name\n * @Date: 2021-01-12 10:42:07\n * @LastEditTime: 2021-01-12 13:59:27\n * @LastEditors: Please set LastEditors\n * @Description: In User Settings Edit\n * @FilePath: /webpack-test/Users/mory/Desktop/qiankun-react/src/App.js\n */function App_App(props){var content=props.content,loading=props.loading;// 路由跳转\nfunction goto(title,href){window.history.pushState({},title,href);}return/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"App\",style:{display:'flex'},children:[/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{style:{width:100},children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{onClick:function onClick(){return goto('react1','/react1');},children:\"react1\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"button\",{onClick:function onClick(){return goto('react2','/react2');},children:\"react2\"})]}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{style:{flexGrow:1},children:[loading&&/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"mask\",children:\"loading...\"}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{dangerouslySetInnerHTML:{__html:content}})]})]});}/* harmony default export */ var src_App = (App_App);\n// EXTERNAL MODULE: ./node_modules/qiankun/es/apis.js + 34 modules\nvar apis = __webpack_require__(178);\n\n// EXTERNAL MODULE: ./node_modules/single-spa/lib/esm/single-spa.min.js\nvar single_spa_min = __webpack_require__(3);\n\n// CONCATENATED MODULE: ./src/utils/index.js\n/*\n * @Author: Lucas\n * @Date: 2021-01-12 14:23:58\n * @LastEditTime: 2021-01-12 15:04:26\n * @LastEditors: Please set LastEditors\n * @Description: 工具库\n * @FilePath: /webpack-test/Users/mory/Desktop/qiankun-react/utils/index.js\n */// 设置默认路由\nfunction setDefaultMountApp(defaultAppLink){// can not use addEventListener once option for ie support\nwindow.addEventListener('single-spa:no-app-change',function listener(){var mountedApps=Object(single_spa_min[\"d\" /* getMountedApps */])();if(!mountedApps.length){Object(single_spa_min[\"f\" /* navigateToUrl */])(defaultAppLink);}window.removeEventListener('single-spa:no-app-change',listener);});}\n// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/esm/defineProperty.js\nvar defineProperty = __webpack_require__(5);\n\n// EXTERNAL MODULE: ./node_modules/lodash/cloneDeep.js\nvar cloneDeep = __webpack_require__(1);\nvar cloneDeep_default = /*#__PURE__*/__webpack_require__.n(cloneDeep);\n\n// CONCATENATED MODULE: ./src/utils/globalState.js\nvar globalState={};var deps={};// 触发全局监听\nfunction emitGlobal(state,prevState){Object.keys(deps).forEach(function(id){if(deps[id]instanceof Function){deps[id](cloneDeep_default()(state),cloneDeep_default()(prevState));}});}function initGlobalState(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(state===globalState){console.warn('[qiankun] state has not changed！');}else{var prevGlobalState=cloneDeep_default()(globalState);globalState=cloneDeep_default()(state);emitGlobal(globalState,prevGlobalState);}return getMicroAppStateActions(\"global-\".concat(+new Date()),true);}function getMicroAppStateActions(id,isMaster){return{/**\n     * onGlobalStateChange 全局依赖监听\n     *\n     * 收集 setState 时所需要触发的依赖\n     *\n     * 限制条件：每个子应用只有一个激活状态的全局监听，新监听覆盖旧监听，若只是监听部分属性，请使用 onGlobalStateChange\n     *\n     * 这么设计是为了减少全局监听滥用导致的内存爆炸\n     *\n     * 依赖数据结构为：\n     * {\n     *   {id}: callback\n     * }\n     *\n     * @param callback\n     * @param fireImmediately\n     */onGlobalStateChange:function onGlobalStateChange(callback,fireImmediately){if(!(callback instanceof Function)){console.error('[qiankun] callback must be function!');return;}if(deps[id]){console.warn(\"[qiankun] '\".concat(id,\"' global listener already exists before this, new listener will overwrite it.\"));}deps[id]=callback;var cloneState=cloneDeep_default()(globalState);if(fireImmediately){callback(cloneState,cloneState);}},/**\n     * setGlobalState 更新 store 数据\n     *\n     * 1. 对输入 state 的第一层属性做校验，只有初始化时声明过的第一层（bucket）属性才会被更改\n     * 2. 修改 store 并触发全局监听\n     *\n     * @param state\n     */setGlobalState:function setGlobalState(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(state===globalState){console.warn('[qiankun] state has not changed！');return false;}var changeKeys=[];var prevGlobalState=cloneDeep_default()(globalState);globalState=cloneDeep_default()(Object.keys(state).reduce(function(_globalState,changeKey){if(isMaster||_globalState.hasOwnProperty(changeKey)){changeKeys.push(changeKey);return Object.assign(_globalState,Object(defineProperty[\"a\" /* default */])({},changeKey,state[changeKey]));}console.warn(\"[qiankun] '\".concat(changeKey,\"' not declared when init state\\uFF01\"));return _globalState;},globalState));if(changeKeys.length===0){console.warn('[qiankun] state has not changed！');return false;}emitGlobal(globalState,prevGlobalState);return true;},// 注销该应用下的依赖\noffGlobalStateChange:function offGlobalStateChange(){delete deps[id];return true;}};}\n// CONCATENATED MODULE: ./src/index.js\n/*\n * @Author: your name\n * @Date: 2021-01-12 10:42:07\n * @LastEditTime: 2021-01-27 14:08:18\n * @LastEditors: Please set LastEditors\n * @Description: In User Settings Edit\n * @FilePath: /webpack-test/Users/mory/Desktop/qiankun-react/src/index.js\n */// import * as serviceWorker from './serviceWorker';\nfunction render(_ref){var appContent=_ref.appContent,loading=_ref.loading;var container=document.getElementById('root');react_dom_default.a.render(/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(src_App,{loading:loading,content:appContent}),container);}/**\n * Step1 初始化应用（可选）\n */render({loading:true});function genActiveRule(routerPrefix){return function(location){return location.pathname.startsWith(routerPrefix);};}/**\n * Step2 注册子应用\n * entry： 为微应用的访问地址\n */Object(apis[\"b\" /* registerMicroApps */])([{name:'react1',entry:'//localhost:6651',render:render,activeRule:genActiveRule('/react1')},{name:'react2',entry:'//localhost:6652',render:render,activeRule:genActiveRule('/react2')}]);var _initGlobalState=initGlobalState({user:'qiankun'}),src_onGlobalStateChange=_initGlobalState.onGlobalStateChange,src_setGlobalState=_initGlobalState.setGlobalState;src_onGlobalStateChange(function(value,prev){return console.log('[onGlobalStateChange - master]:',value,prev);});src_setGlobalState({ignore:'master',user:{name:'master'}});/**\n * Step3 设置默认进入的子应用\n */setDefaultMountApp('/react1');/**\n * Step4 启动应用\n */Object(apis[\"c\" /* start */])();// serviceWorker.unregister();\n\n/***/ }),\n\n/***/ 74:\n/***/ (function(module, exports, __webpack_require__) {\n\n// extracted by mini-css-extract-plugin\n\n/***/ }),\n\n/***/ 75:\n/***/ (function(module, exports, __webpack_require__) {\n\n// extracted by mini-css-extract-plugin\n\n/***/ })\n\n},[[175,1,2]]]);\n});","inputSourceMap":{"version":3,"sources":["webpack/universalModuleDefinition","/Users/mory/Desktop/qiankun-react/master/src/App.js","/Users/mory/Desktop/qiankun-react/master/src/utils/index.js","/Users/mory/Desktop/qiankun-react/master/src/utils/globalState.js","/Users/mory/Desktop/qiankun-react/master/src/index.js","/Users/mory/Desktop/qiankun-react/master/node_modules/mini-css-extract-plugin/dist/loader.js??ref--5-oneOf-4-0!/Users/mory/Desktop/qiankun-react/master/node_modules/css-loader/dist/cjs.js??ref--5-oneOf-4-1!/Users/mory/Desktop/qiankun-react/master/node_modules/postcss-loader/src/index.js??postcss!/Users/mory/Desktop/qiankun-react/master/src/index.css","/Users/mory/Desktop/qiankun-react/master/node_modules/mini-css-extract-plugin/dist/loader.js??ref--5-oneOf-4-0!/Users/mory/Desktop/qiankun-react/master/node_modules/css-loader/dist/cjs.js??ref--5-oneOf-4-1!/Users/mory/Desktop/qiankun-react/master/node_modules/postcss-loader/src/index.js??postcss!/Users/mory/Desktop/qiankun-react/master/src/App.css"],"names":["App","props","content","loading","goto","title","href","window","history","pushState","display","width","flexGrow","__html","setDefaultMountApp","defaultAppLink","addEventListener","listener","mountedApps","getMountedApps","length","navigateToUrl","removeEventListener","globalState","deps","emitGlobal","state","prevState","Object","keys","forEach","id","Function","_cloneDeep","initGlobalState","arguments","undefined","console","warn","prevGlobalState","getMicroAppStateActions","concat","Date","isMaster","onGlobalStateChange","callback","fireImmediately","error","cloneState","setGlobalState","changeKeys","reduce","_globalState","changeKey","hasOwnProperty","push","assign","_defineProperty","offGlobalStateChange","render","appContent","container","document","getElementById","ReactDOM","genActiveRule","routerPrefix","location","pathname","startsWith","registerMicroApps","name","entry","activeRule","user","value","prev","log","ignore","start"],"mappings":"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","file":"x","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"main-main\"] = factory();\n\telse\n\t\troot[\"main-main\"] = factory();\n})(window, function() {\nreturn ","/*\n * @Author: your name\n * @Date: 2021-01-12 10:42:07\n * @LastEditTime: 2021-01-12 13:59:27\n * @LastEditors: Please set LastEditors\n * @Description: In User Settings Edit\n * @FilePath: /webpack-test/Users/mory/Desktop/qiankun-react/src/App.js\n */\nimport React from 'react';\n\nimport './App.css';\n\nfunction App(props) {\n\n  const { content, loading } = props;\n\n  // 路由跳转\n  function goto(title, href) {\n    window.history.pushState({}, title, href);\n  }\n  \n  return (\n    <div className=\"App\" style={{ display: 'flex' }}>\n      <div style={{ width: 100 }}>\n        <button onClick={() => goto('react1', '/react1')}>react1</button>\n        <button onClick={() => goto('react2', '/react2')}>react2</button>\n      </div>\n      <div style={{ flexGrow: 1 }}>\n        {loading && <div className=\"mask\">loading...</div>}\n        <div dangerouslySetInnerHTML={{ __html: content }} />\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n","/*\n * @Author: Lucas\n * @Date: 2021-01-12 14:23:58\n * @LastEditTime: 2021-01-12 15:04:26\n * @LastEditors: Please set LastEditors\n * @Description: 工具库\n * @FilePath: /webpack-test/Users/mory/Desktop/qiankun-react/utils/index.js\n */\n\nimport { getMountedApps, navigateToUrl } from 'single-spa';\n\n// 设置默认路由\nexport function setDefaultMountApp(defaultAppLink) {\n  // can not use addEventListener once option for ie support\n  window.addEventListener('single-spa:no-app-change', function listener() {\n    var mountedApps = getMountedApps();\n\n    if (!mountedApps.length) {\n      navigateToUrl(defaultAppLink);\n    }\n\n    window.removeEventListener('single-spa:no-app-change', listener);\n  });\n}\n","import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _cloneDeep from \"lodash/cloneDeep\";\nvar globalState = {};\nvar deps = {}; // 触发全局监听\n\nfunction emitGlobal(state, prevState) {\n  Object.keys(deps).forEach(function (id) {\n    if (deps[id] instanceof Function) {\n      deps[id](_cloneDeep(state), _cloneDeep(prevState));\n    }\n  });\n}\n\nexport function initGlobalState() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n  if (state === globalState) {\n    console.warn('[qiankun] state has not changed！');\n  } else {\n    var prevGlobalState = _cloneDeep(globalState);\n\n    globalState = _cloneDeep(state);\n    emitGlobal(globalState, prevGlobalState);\n  }\n\n  return getMicroAppStateActions(\"global-\".concat(+new Date()), true);\n}\nexport function getMicroAppStateActions(id, isMaster) {\n  return {\n    /**\n     * onGlobalStateChange 全局依赖监听\n     *\n     * 收集 setState 时所需要触发的依赖\n     *\n     * 限制条件：每个子应用只有一个激活状态的全局监听，新监听覆盖旧监听，若只是监听部分属性，请使用 onGlobalStateChange\n     *\n     * 这么设计是为了减少全局监听滥用导致的内存爆炸\n     *\n     * 依赖数据结构为：\n     * {\n     *   {id}: callback\n     * }\n     *\n     * @param callback\n     * @param fireImmediately\n     */\n    onGlobalStateChange: function onGlobalStateChange(callback, fireImmediately) {\n      if (!(callback instanceof Function)) {\n        console.error('[qiankun] callback must be function!');\n        return;\n      }\n\n      if (deps[id]) {\n        console.warn(\"[qiankun] '\".concat(id, \"' global listener already exists before this, new listener will overwrite it.\"));\n      }\n\n      deps[id] = callback;\n\n      var cloneState = _cloneDeep(globalState);\n\n      if (fireImmediately) {\n        callback(cloneState, cloneState);\n      }\n    },\n\n    /**\n     * setGlobalState 更新 store 数据\n     *\n     * 1. 对输入 state 的第一层属性做校验，只有初始化时声明过的第一层（bucket）属性才会被更改\n     * 2. 修改 store 并触发全局监听\n     *\n     * @param state\n     */\n    setGlobalState: function setGlobalState() {\n      var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n      if (state === globalState) {\n        console.warn('[qiankun] state has not changed！');\n        return false;\n      }\n\n      var changeKeys = [];\n\n      var prevGlobalState = _cloneDeep(globalState);\n\n      globalState = _cloneDeep(Object.keys(state).reduce(function (_globalState, changeKey) {\n        if (isMaster || _globalState.hasOwnProperty(changeKey)) {\n          changeKeys.push(changeKey);\n          return Object.assign(_globalState, _defineProperty({}, changeKey, state[changeKey]));\n        }\n\n        console.warn(\"[qiankun] '\".concat(changeKey, \"' not declared when init state\\uFF01\"));\n        return _globalState;\n      }, globalState));\n\n      if (changeKeys.length === 0) {\n        console.warn('[qiankun] state has not changed！');\n        return false;\n      }\n\n      emitGlobal(globalState, prevGlobalState);\n      return true;\n    },\n    // 注销该应用下的依赖\n    offGlobalStateChange: function offGlobalStateChange() {\n      delete deps[id];\n      return true;\n    }\n  };\n}","/*\n * @Author: your name\n * @Date: 2021-01-12 10:42:07\n * @LastEditTime: 2021-01-27 14:08:18\n * @LastEditors: Please set LastEditors\n * @Description: In User Settings Edit\n * @FilePath: /webpack-test/Users/mory/Desktop/qiankun-react/src/index.js\n */\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n// import * as serviceWorker from './serviceWorker';\nimport { registerMicroApps, start } from 'qiankun';\n\nimport { setDefaultMountApp } from './utils';\n\nimport { initGlobalState } from './utils/globalState';\n\nfunction render({ appContent, loading }) {\n  const container = document.getElementById('root');\n  ReactDOM.render(<App loading={loading} content={appContent} />, container);\n}\n\n/**\n * Step1 初始化应用（可选）\n */\nrender({ loading: true });\n\nfunction genActiveRule(routerPrefix) {\n  return location => location.pathname.startsWith(routerPrefix);\n}\n\n/**\n * Step2 注册子应用\n * entry： 为微应用的访问地址\n */\nregisterMicroApps([\n  {\n    name: 'react1',\n    entry: '//localhost:6651',\n    render,\n    activeRule: genActiveRule('/react1')\n  },\n  {\n    name: 'react2',\n    entry: '//localhost:6652',\n    render,\n    activeRule: genActiveRule('/react2') \n  },\n]);\n\nconst { onGlobalStateChange, setGlobalState } = initGlobalState({\n  user: 'qiankun',\n});\n\nonGlobalStateChange((value, prev) => console.log('[onGlobalStateChange - master]:', value, prev));\n\nsetGlobalState({\n  ignore: 'master',\n  user: {\n    name: 'master',\n  },\n});\n\n/**\n * Step3 设置默认进入的子应用\n */\nsetDefaultMountApp('/react1');\n\n/**\n * Step4 启动应用\n */\nstart();\n\n\n// serviceWorker.unregister();","// extracted by mini-css-extract-plugin","// extracted by mini-css-extract-plugin"]}}